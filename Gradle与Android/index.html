<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">






  
  
  <link rel="stylesheet" media="all" href="/lib/Han/dist/han.min.css?v=3.3">




<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Android,Gradle,">










<meta name="description" content="Groovy：http://docs.groovy-lang.org/Gradle DSL: https://docs.gradle.org/current/javadoc/org/gradle/api/Project.htmlAndroid DSL 与 Task: http://google.github.io/android-gradle-dsl/current/index.html">
<meta name="keywords" content="Android,Gradle">
<meta property="og:type" content="article">
<meta property="og:title" content="Gradle与Android">
<meta property="og:url" content="http://yannischeng.com/Gradle与Android/index.html">
<meta property="og:site_name" content="YannisCheng&#39;s Technology Blogs">
<meta property="og:description" content="Groovy：http://docs.groovy-lang.org/Gradle DSL: https://docs.gradle.org/current/javadoc/org/gradle/api/Project.htmlAndroid DSL 与 Task: http://google.github.io/android-gradle-dsl/current/index.html">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-05-22%2021.03.22.png">
<meta property="og:image" content="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-05-22%2021.50.12.png">
<meta property="og:image" content="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/gradle-%E4%BB%BB%E5%8A%A1%E5%88%9B%E5%BB%BA%E8%AF%B4%E6%98%8E.png">
<meta property="og:image" content="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/commandLineTutorialTasks.png">
<meta property="og:image" content="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-10-14%2014.09.54.png">
<meta property="og:updated_time" content="2018-11-20T13:04:37.105Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Gradle与Android">
<meta name="twitter:description" content="Groovy：http://docs.groovy-lang.org/Gradle DSL: https://docs.gradle.org/current/javadoc/org/gradle/api/Project.htmlAndroid DSL 与 Task: http://google.github.io/android-gradle-dsl/current/index.html">
<meta name="twitter:image" content="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-05-22%2021.03.22.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yannischeng.com/Gradle与Android/">





  <title>Gradle与Android | YannisCheng's Technology Blogs</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta custom-logo">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">YannisCheng's Technology Blogs</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">不必一味的讨好别人，每个人都有自己的活法。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yannischeng.com/Gradle与Android/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="YannisCheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="http://oy991qm3u.bkt.clouddn.com/%E6%A2%B5%E9%AB%98.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YannisCheng's Technology Blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Gradle与Android</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-22T11:43:56+08:00">
                2018-05-22
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-11-20T21:04:37+08:00">
                2018-11-20
              </time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  9,999 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  43 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    

    
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag"># Android</a>
          
            <a href="/tags/Gradle/" rel="tag"># Gradle</a>
          
        </div>
      

    
    
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    YannisCheng
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://yannischeng.com/Gradle与Android/" title="Gradle与Android">http://yannischeng.com/Gradle与Android/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    尊重个人劳动成果，转载请注明出处。 ─=≡Σ(((つ•̀ω•́)つ))
  </li>
</ul>

      </div>
    



    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        <blockquote>
<p>Groovy：<a href="http://docs.groovy-lang.org/" target="_blank" rel="noopener">http://docs.groovy-lang.org/</a><br>Gradle DSL: <a href="https://docs.gradle.org/current/javadoc/org/gradle/api/Project.html" target="_blank" rel="noopener">https://docs.gradle.org/current/javadoc/org/gradle/api/Project.html</a><br>Android DSL 与 Task: <a href="http://google.github.io/android-gradle-dsl/current/index.html" target="_blank" rel="noopener">http://google.github.io/android-gradle-dsl/current/index.html</a></p>
</blockquote>
<a id="more"></a>
<ul>
<li><strong>关键词：</strong> <strong>Android、Groovy、DSL语言、Gradle</strong></li>
<li><p><strong>关系：</strong><br><strong>-&gt;</strong> Android采用Gradle作为首选的构建自动化系统，使用Gradle强大的依赖关系管理功能<br><strong>-&gt;</strong> Gradle基于Groovy（一种用于编写Gradle的脚本语言），是一个<strong>开源构建自动化系统</strong>，它引入了基于Groovy的领域特定语言（DSL）来配置项目<br><strong>-&gt;</strong> Groovy是一种运行在JVM虚拟机上的脚本语言，能够与Java语言无缝结合。</p>
</li>
<li><p><strong>区分：<code>Android Plugin 版本</code> 和 <code>Gradle版本</code></strong></p>
</li>
<li><p><strong>Gradle插件 在Android中的用处</strong>：</p>
<ul>
<li>插件化 VirtualAPK</li>
<li>热修复 Tinker、Robust</li>
<li>构建系统：多渠道打包</li>
<li>Gradle插件</li>
</ul>
</li>
</ul>
<h1 id="1-Gradle概述"><a href="#1-Gradle概述" class="headerlink" title="1. Gradle概述"></a>1. Gradle概述</h1><blockquote>
<p>参考：<a href="https://docs.gradle.org/current/userguide/installation.html" target="_blank" rel="noopener">https://docs.gradle.org/current/userguide/installation.html</a></p>
</blockquote>
<h2 id="1-1-安装"><a href="#1-1-安装" class="headerlink" title="1.1 安装"></a>1.1 安装</h2><h3 id="1-1-1-前提条件"><a href="#1-1-1-前提条件" class="headerlink" title="1.1.1 前提条件"></a>1.1.1 前提条件</h3><p>Gradle可在所有主要操作系统上运行，并且只需要Java JDK 7或更高版本即可运行。检查，运行<code>java -version</code>。你应该看到这样的东西：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">❯java -version java version“1.8.0_151” </span><br><span class="line">Java™SE运行时环境（build 1.8.0_151-b12）</span><br><span class="line">Java HotSpot™64位服务器虚拟机（内置版本25.151-b12，混合模式）</span><br></pre></td></tr></table></figure>
<p>Gradle自带Groovy库，因此Groovy不需要安装。Gradle将忽略任何现有的Groovy安装。<br>Gradle使用它在您的路径中找到的任何JDK。或者，您可以将JAVA_HOME环境变量设置为指向所需JDK的安装目录。</p>
<h3 id="1-1-2-安装"><a href="#1-1-2-安装" class="headerlink" title="1.1.2 安装"></a>1.1.2 安装</h3><p>通过 <code>homebrew</code> 安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install gradle</span><br></pre></td></tr></table></figure>
<h3 id="1-1-3-验证安装"><a href="#1-1-3-验证安装" class="headerlink" title="1.1.3 验证安装"></a>1.1.3 验证安装</h3><p>输入命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle -v</span><br></pre></td></tr></table></figure>
<p>得到的结果，如果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Welcome to Gradle 4.7!</span><br><span class="line"></span><br><span class="line">Here are the highlights of this release:</span><br><span class="line"> - Incremental annotation processing</span><br><span class="line"> - JDK 10 support</span><br><span class="line"> - Grouped non-interactive console logs</span><br><span class="line"> - Failed tests are re-run first for quicker feedback</span><br><span class="line"></span><br><span class="line">For more details see https://docs.gradle.org/4.7/release-notes.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------------------------------------------------------</span><br><span class="line">Gradle 4.7</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Build time:   2018-04-18 09:09:12 UTC</span><br><span class="line">Revision:     b9a962bf70638332300e7f810689cb2febbd4a6c</span><br><span class="line"></span><br><span class="line">Groovy:       2.4.12</span><br><span class="line">Ant:          Apache Ant(TM) version 1.9.9 compiled on February 2 2017</span><br><span class="line">JVM:          1.8.0_131 (Oracle Corporation 25.131-b11)</span><br><span class="line">OS:           Mac OS X 10.13.4 x86_64</span><br></pre></td></tr></table></figure>
<p>则表示安装成功。</p>
<h2 id="1-2-创建新的Gradle项目"><a href="#1-2-创建新的Gradle项目" class="headerlink" title="1.2 创建新的Gradle项目"></a>1.2 创建新的Gradle项目</h2><h3 id="1-2-1-创建一个新的目录"><a href="#1-2-1-创建一个新的目录" class="headerlink" title="1.2.1 创建一个新的目录"></a>1.2.1 创建一个新的目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir Gradle_Projects</span><br></pre></td></tr></table></figure>
<p>进入新创建的目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd Gradle_Projects/</span><br></pre></td></tr></table></figure>
<h3 id="1-2-2-初始化项目"><a href="#1-2-2-初始化项目" class="headerlink" title="1.2.2 初始化项目"></a>1.2.2 初始化项目</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle init</span><br></pre></td></tr></table></figure>
<p>结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Starting a Gradle Daemon (subsequent builds will be faster)</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL in 3s</span><br><span class="line">2 actionable tasks: 2 executed</span><br></pre></td></tr></table></figure>
<p>表示初始化成功。</p>
<p>初始化成功后，项目的目录及文件功能说明：</p>
<p><img src="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-05-22%2021.03.22.png" alt></p>
<h3 id="1-2-3-创建一个新任务"><a href="#1-2-3-创建一个新任务" class="headerlink" title="1.2.3 创建一个新任务"></a>1.2.3 创建一个新任务</h3><p>Gradle提供了用于通过基于Groovy或Kotlin的DSL创建和配置任务的API。</p>
<ul>
<li>在项目的“根目录”下创建一个文件夹“src”</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir src</span><br></pre></td></tr></table></figure>
<p>并进入此文件夹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd src/</span><br></pre></td></tr></table></figure>
<ul>
<li><p>在新创建的“src”目录下创建一个新文件“myfile.txt”，并写入“Hello,Word !”：</p>
</li>
<li><p>在项目配置脚本文件<code>build.gradle</code>中，定义一个<code>copy</code>方法，具体为：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">task copy(type: Copy, group: &quot;Custom&quot;, description: &quot;Copies sources to the dest directory&quot;) &#123;</span><br><span class="line">    from &quot;src&quot;</span><br><span class="line">    into &quot;dest&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>在项目的“根目录”下执行 <code>copy</code> 方法的命令：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew copy</span><br></pre></td></tr></table></figure>
<p>若显示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BUILD SUCCESSFUL in 10m 11s</span><br><span class="line">1 actionable task: 1 executed</span><br></pre></td></tr></table></figure>
<p>则表示任务添加成功。成功之后的项目树结构为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Gradle_Projects</span><br><span class="line">├── Gradle_Projects</span><br><span class="line">├── build.gradle</span><br><span class="line">├── dest</span><br><span class="line">│   └── myfile.txt</span><br><span class="line">├── gradle</span><br><span class="line">│   └── wrapper</span><br><span class="line">│       ├── gradle-wrapper.jar</span><br><span class="line">│       └── gradle-wrapper.properties</span><br><span class="line">├── gradlew</span><br><span class="line">├── gradlew.bat</span><br><span class="line">├── settings.gradle</span><br><span class="line">└── src</span><br><span class="line">    └── myfile.txt</span><br></pre></td></tr></table></figure>
<p><strong>注意：本人在执行 <code>copy</code> 方法命令时，并没有直接显示结果，而是先下载了一个gradle-4.7-bin.zip文件</strong></p>
<h3 id="1-2-4-应用一个插件"><a href="#1-2-4-应用一个插件" class="headerlink" title="1.2.4 应用一个插件"></a>1.2.4 应用一个插件</h3><p>Gradle包含一系列插件，Gradle插件门户中提供了许多插件。插件中包含的其中一个插件就是base插件。结合调用的核心类型Zip，可以使用配置的名称和位置创建项目的zip存档。</p>
<p>使用语法将base插件添加到build.gradle文件中plugins。<strong>确保plugins {}在文件顶部添加该块（否则失败）</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id &quot;base&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在添加一个从该src目录创建一个zip存档的任务。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">task zip(type: Zip, group: &quot;Archive&quot;, description: &quot;Archives sources in a zip file&quot;) &#123;</span><br><span class="line">    from &quot;src&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>若显示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BUILD SUCCESSFUL in 0s</span><br><span class="line">1 actionable task: 1 executed</span><br></pre></td></tr></table></figure>
<p>则表示任务执行成功，文件树为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Gradle_Projects</span><br><span class="line">├── Gradle_Projects</span><br><span class="line">├── build</span><br><span class="line">│   └── distributions</span><br><span class="line">│       └── Gradle_Projects.zip</span><br><span class="line">├── build.gradle</span><br><span class="line">├── dest</span><br><span class="line">│   └── myfile.txt</span><br><span class="line">├── gradle</span><br><span class="line">│   └── wrapper</span><br><span class="line">│       ├── gradle-wrapper.jar</span><br><span class="line">│       └── gradle-wrapper.properties</span><br><span class="line">├── gradlew</span><br><span class="line">├── gradlew.bat</span><br><span class="line">├── settings.gradle</span><br><span class="line">└── src</span><br><span class="line">    └── myfile.txt</span><br></pre></td></tr></table></figure>
<p>此任务是将 <code>src</code> 文件夹中的 <code>所有文件</code> 打包。zip包中的内容为：</p>
<p><img src="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-05-22%2021.50.12.png" alt></p>
<h3 id="1-2-5-发现更多的可用-task"><a href="#1-2-5-发现更多的可用-task" class="headerlink" title="1.2.5 发现更多的可用 task"></a>1.2.5 发现更多的可用 <code>task</code></h3><p>执行命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew tasks</span><br></pre></td></tr></table></figure>
<p>结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">------------------------------------------------------------</span><br><span class="line">All tasks runnable from root project</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Android tasks</span><br><span class="line">-------------</span><br><span class="line">androidDependencies - Displays the Android dependencies of the project.（显示项目的Android依赖项）</span><br><span class="line">signingReport - Assembles and tests this project.(显示每个变体的签名信息)</span><br><span class="line">sourceSets -  Prints out all the source sets defined in this project.(打印出此项目中定义的所有源集)</span><br><span class="line"></span><br><span class="line">Build tasks</span><br><span class="line">-----------</span><br><span class="line">assemble - Assembles all variants of all applications and secondary packages（组装所有应用程序和辅助包的所有变体）。</span><br><span class="line">assembleAndroidTest - 组装所有Test应用程序。</span><br><span class="line">assembleDebug - 组装所有 Debug 构建。</span><br><span class="line">assembleRelease - 汇总所有 Release 构建。</span><br><span class="line">build - Assembles and tests this project.</span><br><span class="line">buildDependents - Assembles and tests this project and all projects that depend on it（以及依赖它的所有项目）.</span><br><span class="line">buildNeeded - Assembles and tests this project and all projects it depends on（及其依赖的所有项目。）.</span><br><span class="line">clean - Deletes the build directory.</span><br><span class="line">cleanBuildCache - Deletes the build cache directory.</span><br><span class="line">compileDebugAndroidTestSources</span><br><span class="line">compileDebugSources</span><br><span class="line">compileDebugUnitTestSources</span><br><span class="line">compileReleaseSources</span><br><span class="line">compileReleaseUnitTestSources</span><br><span class="line">mockableAndroidJar - Creates a version of android.jar that&apos;s suitable for unit tests.</span><br><span class="line"></span><br><span class="line">Build Setup tasks</span><br><span class="line">-----------------</span><br><span class="line">init - Initializes a new Gradle build.</span><br><span class="line">wrapper - Generates Gradle wrapper files.</span><br><span class="line"></span><br><span class="line">Help tasks</span><br><span class="line">----------</span><br><span class="line">buildEnvironment - Displays all buildscript dependencies declared in root project &apos;2018-07&apos;.</span><br><span class="line">components - Displays the components produced by root project &apos;2018-07&apos;. [incubating]</span><br><span class="line">dependencies - Displays all dependencies declared in root project &apos;2018-07&apos;.</span><br><span class="line">dependencyInsight - Displays the insight into a specific dependency in root project &apos;2018-07&apos;.</span><br><span class="line">dependentComponents - Displays the dependent components of components in root project &apos;2018-07&apos;. [incubating]</span><br><span class="line">help - Displays a help message.</span><br><span class="line">model - Displays the configuration model of root project &apos;2018-07&apos;. [incubating]</span><br><span class="line">projects - Displays the sub-projects of root project &apos;2018-07&apos;.</span><br><span class="line">properties - Displays the properties of root project &apos;2018-07&apos;.</span><br><span class="line">tasks - Displays the tasks runnable from root project &apos;2018-07&apos; (some of the displayed tasks may belong to subprojects).</span><br><span class="line"></span><br><span class="line">Install tasks</span><br><span class="line">-------------</span><br><span class="line">installDebug - Installs the Debug build.</span><br><span class="line">installDebugAndroidTest - Installs the android (on device) tests for the Debug build.</span><br><span class="line">uninstallAll - Uninstall all applications.</span><br><span class="line">uninstallDebug - Uninstalls the Debug build.</span><br><span class="line">uninstallDebugAndroidTest - Uninstalls the android (on device) tests for the Debug build.</span><br><span class="line">uninstallRelease - Uninstalls the Release build.</span><br><span class="line"></span><br><span class="line">Verification tasks</span><br><span class="line">------------------</span><br><span class="line">check - Runs all checks.</span><br><span class="line">connectedAndroidTest - Installs and runs instrumentation tests for all flavors on connected devices.</span><br><span class="line">connectedCheck - Runs all device checks on currently connected devices.</span><br><span class="line">connectedDebugAndroidTest - Installs and runs the tests for debug on connected devices.</span><br><span class="line">deviceAndroidTest - Installs and runs instrumentation tests using all Device Providers.</span><br><span class="line">deviceCheck - Runs all device checks using Device Providers and Test Servers.</span><br><span class="line">lint - Runs lint on all variants.</span><br><span class="line">lintDebug - Runs lint on the Debug build.</span><br><span class="line">lintRelease - Runs lint on the Release build.</span><br><span class="line">lintVitalRelease - Runs lint on just the fatal issues in the release build.</span><br><span class="line">test - Run unit tests for all variants.</span><br><span class="line">testDebugUnitTest - Run unit tests for the debug build.</span><br><span class="line">testReleaseUnitTest - Run unit tests for the release build.</span><br><span class="line"></span><br><span class="line">To see all tasks and more detail, run gradlew tasks --all</span><br><span class="line"></span><br><span class="line">To see more detail about a task, run gradlew help --task &lt;task&gt;</span><br></pre></td></tr></table></figure>
<p><strong>说明：</strong></p>
<p><code>task任务参数</code> 与 <code>build.gradle</code> 文件中的代码对比：</p>
<p><img src="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/gradle-%E4%BB%BB%E5%8A%A1%E5%88%9B%E5%BB%BA%E8%AF%B4%E6%98%8E.png" alt></p>
<h2 id="1-3-命令"><a href="#1-3-命令" class="headerlink" title="1.3 命令"></a>1.3 命令</h2><h3 id="1-3-1-一般命令："><a href="#1-3-1-一般命令：" class="headerlink" title="1.3.1 一般命令："></a>1.3.1 一般命令：</h3><ul>
<li>Gradle命令符合以下结构，在任务名称之前和之后允许选项：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle [taskName ...] [--option-name ...]</span><br></pre></td></tr></table></figure>
<p>如果指定了<strong>多个任务</strong>，则应该用<strong>空格分隔</strong>。</p>
<ul>
<li>接受值的选项可以在选项和参数之间使用或不使用<code>=</code>指定; 然而，推荐使用<code>=</code>。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--console=plain</span><br></pre></td></tr></table></figure>
<ul>
<li>启用行为的选项具有长形式的选项，而用<code>--no-</code>指定的反向选项。 以下是相对的命令。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--build-cache</span><br><span class="line">--no-build-cache</span><br></pre></td></tr></table></figure>
<p>许多长期形式的期权都有相当于短期期权的选择。 以下是等同的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--help</span><br><span class="line">-h</span><br></pre></td></tr></table></figure>
<h3 id="1-3-2-执行任务"><a href="#1-3-2-执行任务" class="headerlink" title="1.3.2 执行任务"></a>1.3.2 执行任务</h3><ul>
<li>运行任务及。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle myTask</span><br></pre></td></tr></table></figure>
<ul>
<li>在<strong>多项目构建</strong>中执行任务</li>
</ul>
<p>在多项目构建中，可以使用 <code>:</code> 分隔 <strong>子项目名称</strong> 和 <strong>任务名称</strong> 来执行子项目任务。 从根项目运行时，以下内容得到的结果是等价的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gradle :mySubproject:taskName</span><br><span class="line">gradle mySubproject:taskName</span><br></pre></td></tr></table></figure>
<ul>
<li>也可以<strong>仅使用任务名称</strong>为所有子项目运行任务。 例如，这将从根项目目录中调用时为所有子项目运行“测试”任务。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle test</span><br></pre></td></tr></table></figure>
<ul>
<li>从子项目中调用Gradle时，应该省略项目名称：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd mySubproject</span><br><span class="line">gradle taskName</span><br></pre></td></tr></table></figure>
<ul>
<li>执行多任务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle test deploy</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>排除</strong>执行任务中的引用任务</li>
</ul>
<p>您可以使用<code>-x</code>或<code>--exclude-task</code>命令行选项排除正在执行的任务，并提供要排除的任务的名称。</p>
<p><img src="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/commandLineTutorialTasks.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">gradle dist --exclude-task test</span><br><span class="line"></span><br><span class="line">&gt; Task :compile</span><br><span class="line">compiling source</span><br><span class="line"></span><br><span class="line">&gt; Task :dist</span><br><span class="line">building the distribution</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL in 0s</span><br><span class="line">2 actionable tasks: 2 executed</span><br></pre></td></tr></table></figure>
<p>您可以看到 <code>test</code> 任务未执行，即使它是 <code>dist</code> 任务的依赖项。 测试任务的依赖项（如compileTest）也不会执行。 另一个任务所需的测试依赖关系，如编译，仍然执行。</p>
<ul>
<li><strong>强制</strong>任务执行</li>
</ul>
<p>您可以使用 <code>--rerun-tasks</code> 选项强制Gradle执行所有忽略最新检查的任务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle test --rerun-tasks</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>发生故障</strong>时继续构建</li>
</ul>
<p>默认情况下，一旦任何任务失败，Gradle将中止执行并使构建失败。 这样可以尽快完成构建，但隐藏了可能发生的其他故障。 为了在单个构建执行中发现尽可能多的失败，可以使用 <code>--continue</code> 选项。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle test --continue</span><br></pre></td></tr></table></figure>
<p>当使用<code>--continue</code>执行时，Gradle将执行每个要执行的任务，而该任务的所有依赖关系完成时不会失败，而不会在遇到第一个失败时立即停止。 每次遇到的故障将在构建结束时报告。</p>
<p>如果任务失败，则任何依赖它的后续任务将不会执行。 例如，如果测试中的代码出现编译失败，测试将不会运行; 因为测试任务将取决于编译任务（直接或间接）。</p>
<ul>
<li>任务名称缩写</li>
</ul>
<p>在命令行中指定任务时，不必提供任务的全名。 您只需提供足够的任务名称即可唯一标识任务。 举例来说，Gradle可能足以让Gradle识别检查任务。</p>
<p>您还可以缩写骆驼案件任务名称中的每个单词。 例如，您可以通过运行gradle compTest或gradle cT来执行任务compileTest。</p>
<p>示例：缩写骆驼案例任务名称</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle cT</span><br></pre></td></tr></table></figure>
<p>您还可以将这些缩写与-x命令行选项一起使用。</p>
<h3 id="1-3-3-常用-Task"><a href="#1-3-3-常用-Task" class="headerlink" title="1.3.3 常用 Task"></a>1.3.3 常用 Task</h3><p>以下是由<strong>内置</strong>和<strong>最主要的Gradle插件</strong>应用的任务约定。</p>
<ul>
<li>计算所有输出</li>
</ul>
<p>在Gradle构建中，通常build指定汇编所有输出并运行所有检查。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle build</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>运行</strong>应用程序</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle run</span><br></pre></td></tr></table></figure>
<ul>
<li>运行所有<strong>检查</strong></li>
</ul>
<p>所有验证任务都是常见的，包括测试和测试，都是使用check任务执行的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle check</span><br></pre></td></tr></table></figure>
<ul>
<li>清洁输出</li>
</ul>
<p>您可以使用clean任务删除构建目录的内容，但这样做会导致预先计算的输出丢失，从而导致后续任务执行的额外构建时间大大增加。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle clean</span><br></pre></td></tr></table></figure>
<h2 id="1-3-4-项目信息-Task"><a href="#1-3-4-项目信息-Task" class="headerlink" title="1.3.4 项目信息 Task"></a>1.3.4 项目信息 Task</h2><p>Gradle提供了几个内置任务，这些任务显示了构建的特定细节。这对理解构建的结构和依赖关系以及调试问题很有用。</p>
<ul>
<li>列出 项目</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle projects</span><br></pre></td></tr></table></figure>
<p>结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; Task :projects</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------</span><br><span class="line">Root project</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Root project &apos;HelloGradle&apos;</span><br><span class="line">\--- Project &apos;:app&apos;</span><br></pre></td></tr></table></figure>
<ul>
<li>列出 task -1：  <strong>:app:tasks</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle :app:tasks</span><br></pre></td></tr></table></figure>
<ul>
<li>列出 task -2： <strong>gradle tasks</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle tasks</span><br></pre></td></tr></table></figure>
<ul>
<li>列出 task -3：<strong>gradle tasks –all</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle tasks --all</span><br></pre></td></tr></table></figure>
<ul>
<li>显示 task 使用详情</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle help --task check</span><br></pre></td></tr></table></figure>
<p>结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; Task :help</span><br><span class="line">Detailed task information for check // 详细任务信息</span><br><span class="line"></span><br><span class="line">Path // 路径</span><br><span class="line">     :app:check</span><br><span class="line"></span><br><span class="line">Type // 类型</span><br><span class="line">     Task (org.gradle.api.Task)</span><br><span class="line"></span><br><span class="line">Description // 描述</span><br><span class="line">     Runs all checks.</span><br><span class="line"></span><br><span class="line">Group // 组</span><br><span class="line">     verification</span><br></pre></td></tr></table></figure>
<ul>
<li>列出项目依赖关系</li>
</ul>
<blockquote>
<p>参考：<a href="https://docs.gradle.org/current/userguide/inspecting_dependencies.html" target="_blank" rel="noopener">https://docs.gradle.org/current/userguide/inspecting_dependencies.html</a></p>
</blockquote>
<p>运行gradle dependencies将为您提供所选项目的依赖关系列表，按配置细分。对于每个配置，该配置的直接和传递依赖关系都显示在树中。以下是此报告的一个示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle dependencies</span><br></pre></td></tr></table></figure>
<p>运行 <code>gradle buildEnvironment</code> 可视化所选项目的构建脚本依赖关系，类似于 <code>gradle dependencies</code> 可视化正在构建的软件的依赖关系。</p>
<ul>
<li>列出项目属性</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle properties</span><br></pre></td></tr></table></figure>
<ul>
<li>列出 model 信息</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle model</span><br></pre></td></tr></table></figure>
<p>结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">&gt; Task :model</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------</span><br><span class="line">Root project</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">+ tasks</span><br><span class="line">      | Type:           org.gradle.model.ModelMap&lt;org.gradle.api.Task&gt;</span><br><span class="line">      | Creator:        Project.&lt;init&gt;.tasks()</span><br><span class="line">    + buildEnvironment</span><br><span class="line">          | Type:       org.gradle.api.tasks.diagnostics.BuildEnvironmentReportTask</span><br><span class="line">          | Value:      task &apos;:buildEnvironment&apos;</span><br><span class="line">          | Creator:    tasks.addPlaceholderAction(buildEnvironment)</span><br><span class="line">          | Rules:</span><br><span class="line">             ⤷ copyToTaskContainer</span><br><span class="line">    + clean</span><br><span class="line">          | Type:       org.gradle.api.tasks.Delete</span><br><span class="line">          | Value:      task &apos;:clean&apos;</span><br><span class="line">          | Creator:    Project.&lt;init&gt;.tasks.clean()</span><br><span class="line">          | Rules:</span><br><span class="line">             ⤷ copyToTaskContainer</span><br><span class="line">    + components</span><br><span class="line">          | Type:       org.gradle.api.reporting.components.ComponentReport</span><br><span class="line">          | Value:      task &apos;:components&apos;</span><br><span class="line">          | Creator:    tasks.addPlaceholderAction(components)</span><br><span class="line">          | Rules:</span><br><span class="line">             ⤷ copyToTaskContainer</span><br><span class="line">    + dependencies</span><br><span class="line">          | Type:       org.gradle.api.tasks.diagnostics.DependencyReportTask</span><br><span class="line">          | Value:      task &apos;:dependencies&apos;</span><br><span class="line">          | Creator:    tasks.addPlaceholderAction(dependencies)</span><br><span class="line">          | Rules:</span><br><span class="line">             ⤷ copyToTaskContainer</span><br><span class="line">    + dependencyInsight</span><br><span class="line">          | Type:       org.gradle.api.tasks.diagnostics.DependencyInsightReportTask</span><br><span class="line">          | Value:      task &apos;:dependencyInsight&apos;</span><br><span class="line">          | Creator:    tasks.addPlaceholderAction(dependencyInsight)</span><br><span class="line">          | Rules:</span><br><span class="line">             ⤷ HelpTasksPlugin.Rules#addDefaultDependenciesReportConfiguration(DependencyInsightReportTask, ServiceRegistry)</span><br><span class="line">             ⤷ copyToTaskContainer</span><br><span class="line">    + dependentComponents</span><br><span class="line">          | Type:       org.gradle.api.reporting.dependents.DependentComponentsReport</span><br><span class="line">          | Value:      task &apos;:dependentComponents&apos;</span><br><span class="line">          | Creator:    tasks.addPlaceholderAction(dependentComponents)</span><br><span class="line">          | Rules:</span><br><span class="line">             ⤷ copyToTaskContainer</span><br><span class="line">    + help</span><br><span class="line">          | Type:       org.gradle.configuration.Help</span><br><span class="line">          | Value:      task &apos;:help&apos;</span><br><span class="line">          | Creator:    tasks.addPlaceholderAction(help)</span><br><span class="line">          | Rules:</span><br><span class="line">             ⤷ copyToTaskContainer</span><br><span class="line">    + init</span><br><span class="line">          | Type:       org.gradle.buildinit.tasks.InitBuild</span><br><span class="line">          | Value:      task &apos;:init&apos;</span><br><span class="line">          | Creator:    tasks.addPlaceholderAction(init)</span><br><span class="line">          | Rules:</span><br><span class="line">             ⤷ copyToTaskContainer</span><br><span class="line">    + model</span><br><span class="line">          | Type:       org.gradle.api.reporting.model.ModelReport</span><br><span class="line">          | Value:      task &apos;:model&apos;</span><br><span class="line">          | Creator:    tasks.addPlaceholderAction(model)</span><br><span class="line">          | Rules:</span><br><span class="line">             ⤷ copyToTaskContainer</span><br><span class="line">    + projects</span><br><span class="line">          | Type:       org.gradle.api.tasks.diagnostics.ProjectReportTask</span><br><span class="line">          | Value:      task &apos;:projects&apos;</span><br><span class="line">          | Creator:    tasks.addPlaceholderAction(projects)</span><br><span class="line">          | Rules:</span><br><span class="line">             ⤷ copyToTaskContainer</span><br><span class="line">    + properties</span><br><span class="line">          | Type:       org.gradle.api.tasks.diagnostics.PropertyReportTask</span><br><span class="line">          | Value:      task &apos;:properties&apos;</span><br><span class="line">          | Creator:    tasks.addPlaceholderAction(properties)</span><br><span class="line">          | Rules:</span><br><span class="line">             ⤷ copyToTaskContainer</span><br><span class="line">    + tasks</span><br><span class="line">          | Type:       org.gradle.api.tasks.diagnostics.TaskReportTask</span><br><span class="line">          | Value:      task &apos;:tasks&apos;</span><br><span class="line">          | Creator:    tasks.addPlaceholderAction(tasks)</span><br><span class="line">          | Rules:</span><br><span class="line">             ⤷ copyToTaskContainer</span><br><span class="line">    + wrapper</span><br><span class="line">          | Type:       org.gradle.api.tasks.wrapper.Wrapper</span><br><span class="line">          | Value:      task &apos;:wrapper&apos;</span><br><span class="line">          | Creator:    tasks.addPlaceholderAction(wrapper)</span><br><span class="line">          | Rules:</span><br><span class="line">             ⤷ copyToTaskContainer</span><br></pre></td></tr></table></figure>
<p>model信息 - 模型元素的细节</p>
<table>
<thead>
<tr>
<th>详情</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>类型-Type</td>
<td>这是模型元素的基础类型，通常是完全限定的类名。</td>
</tr>
<tr>
<td>值-Value</td>
<td>当模型元素可以表示为字符串时，在报告中有条件地显示。</td>
</tr>
<tr>
<td>创造者-Creator</td>
<td>每个模型元素都有一个创建者。创建者表示模型元素的起源（即创建模型元素的原因）</td>
</tr>
<tr>
<td>规则-Rules</td>
<td>是规则的列表，不包括为给定模型元素执行的创建者规则。规则的显示顺序反映了它们的执行顺序</td>
</tr>
</tbody>
</table>
<h1 id="2-Gradle-与-Android-Studio-结合"><a href="#2-Gradle-与-Android-Studio-结合" class="headerlink" title="2. Gradle 与 Android Studio 结合"></a>2. Gradle 与 Android Studio 结合</h1><p>Android应用程序使用 <strong>Gradle</strong> 作为构建工具，通常通过唯一受支持的IDE：<strong>Android Studio</strong>。本小节来描述创建新的Android应用程序时生成的<strong>Gradle构建文件的细节</strong>，以及<strong>如何使用Gradle为其调用相关的构建任务</strong>。 </p>
<p><strong>Gradle 文件与语法关系</strong></p>
<p><img src="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-10-14%2014.09.54.png" alt></p>
<p><strong>Gradle 中重要的2个对象</strong></p>
<ul>
<li><strong>project</strong></li>
<li><strong>task</strong></li>
</ul>
<h2 id="2-1-Gradle-Wrapper"><a href="#2-1-Gradle-Wrapper" class="headerlink" title="2.1 Gradle Wrapper"></a>2.1 Gradle Wrapper</h2><p><code>Wrapper</code> 就是对 <code>Gradle</code> 的一层包装。在项目开发过程中，使用到的都是 <code>Wrapper</code> 方式，而不是专门的手动下载Zip压缩包，配置 Gradle 环境 这些操作。</p>
<h3 id="2-1-1-生成-Wrapper"><a href="#2-1-1-生成-Wrapper" class="headerlink" title="2.1.1 生成 Wrapper"></a>2.1.1 生成 Wrapper</h3><p>在项目根目录中，输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gradle wraapper</span><br><span class="line">``` </span><br><span class="line"> </span><br><span class="line"> 即可生成 `wrapper` 文件夹。</span><br><span class="line"> 此外，在执行以上命令时，还可以通过添加参数的方式，来决定具体使用哪个版本的 gradle 来管理项目（若不声明，则表示使用当前版本）。例如一下命令表示使用的是“2.4版本”：</span><br></pre></td></tr></table></figure>
<p>gradle wrapper –gradle-version 2.4<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**注意：** </span><br><span class="line"></span><br><span class="line">- 1、在配置了 `gradle` 的环境下，执行</span><br></pre></td></tr></table></figure></p>
<p>gradle init<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> 命令后，已经生成  `gradle` 文件夹。</span><br><span class="line"> </span><br><span class="line"> - 2、 根据其他博客的描述，将 `distributionUrl=https\://services.gradle.org/distributions/gradle-4.4-bin.zip` 中的 `bin` 修改为 `all` 时，是可以看到Gradle源码的。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 2.1.2 在 `Android studio` 中</span><br><span class="line"></span><br><span class="line">当使用 `Wrapper` 第一次启动 `Gradle` 时，首先检查相应版本的Gradle是否被下载，若未下载则是先按照配置文件对其进行下载，然后再使用，若已经存在，则是直接使用。</span><br><span class="line"></span><br><span class="line">**Gradle 的 Wrapper配置** 如图所示：</span><br><span class="line"></span><br><span class="line">![](https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-10-14%2015.29.18.png)</span><br><span class="line"></span><br><span class="line">其中：前4行表示 `Wrapper` 路径，最后一行表示 `使用的相应版本的gradle的下载路径`。</span><br><span class="line">有了这个文件，我们就可以通过 `Wrapper` 非常方便的的使用gradle。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 2.2 Android 应用程序模块 的默认项目结构</span><br><span class="line"></span><br><span class="line">![](https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/project-structure_2x.png)</span><br><span class="line"></span><br><span class="line">`Android Studio` 将每个模块的**源代码**和**资源逻辑**分组到 **源集（Source Set）**中。`Android Studio` **不会自动创建它们**。而是 Gradle 在特定版本的 Android插件下构建它们。</span><br><span class="line"></span><br><span class="line">`src/main/`：该源代码集包括所有构建变体的 **通用代码和资源**。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 2.3 工程配置文件</span><br><span class="line"></span><br><span class="line">![](https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/Project-View-Android.png)</span><br><span class="line"></span><br><span class="line">- **(Project: HelloWorldGradle)**</span><br><span class="line">- **(Module: app)** 附加（include &apos;:app&apos;）到 顶层构建文件。</span><br><span class="line"></span><br><span class="line">- **gradle.properties**。</span><br><span class="line"></span><br><span class="line"> - 一个是本地项目。</span><br><span class="line"> - 一个只有gradle.properties在.gradle主目录的子目录中有全局文件的同名文件才存在。</span><br><span class="line"></span><br><span class="line">- **settings.gradle**由Gradle用于 **配置多项目构建**，应该由一行代码组成：</span><br></pre></td></tr></table></figure></p>
<p>include ‘:app’<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> 这告诉Gradle该app子目录也是一个Gradle项目。</span><br><span class="line"></span><br><span class="line">- **gradle-wrapper.properties**，它配置了所谓的 **Gradle Wrapper**。这使您可以构建Android项目，而无需首先安装Gradle。该文件的内容应该类似于：</span><br></pre></td></tr></table></figure></p>
<p>distributionBase=GRADLE_USER_HOME<br>distributionPath=wrapper/dists<br>zipStoreBase=GRADLE_USER_HOME<br>zipStorePath=wrapper/dists<br>distributionUrl=https\://services.gradle.org/distributions/gradle-4.1-all.zip<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">前四行表示当包装首次运行时，它将下载Gradle发行版并将其存储在主目录`.gradle/wrapper/dists`中的目录中。</span><br><span class="line"></span><br><span class="line">最后一行显示了`distributionUrl` Gradle将下载指定分布的位置的值。</span><br><span class="line"></span><br><span class="line">- **local.properties**</span><br><span class="line"></span><br><span class="line">配置构建系统的本地环境属性，例如SDK安装路径。由于此文件的内容是由Android Studio自动生成的，并且特定于本地开发人员环境，因此您不应该手动修改此文件或将其检入您的版本控制系统。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 2.3.1 Project 中的 build.gradle文件</span><br><span class="line"></span><br><span class="line">&gt; **DSL元素** http://google.github.io/android-gradle-dsl/current/</span><br></pre></td></tr></table></figure></p>
<p>// Top-level build file where you can add configuration options common to all sub-projects/modules.</p>
<p>/ ** </p>
<ul>
<li>buildscript块是为Gradle本身配置存储库和依赖项的地方，也就是说，不应该在这里为模块包含依赖项。</li>
<li>例如，此块包含用于</li>
<li>Gradle 的Android插件作为依赖项，因为它提供了Gradle 生成Android应用程序模块所需的附加指令。</li>
<li><p>/<br>buildscript {<br> / **      </p>
<ul>
<li>repositories块配置Gradle用来 搜索或下载依赖项的存储库。</li>
<li>Gradle预先配置对远程存储库的支持，如JCenter，Maven Central和Ivy。你也可以使用本地存储库或定义您自己的远程存储库。</li>
<li>下面的代码将JCenter 、google定义为Gradle应该用来查找其依赖项的存储库。<br>*使用Android Studio 3.0及更高版本<br>创建的新项目还包括 Google的Maven存储库。</li>
<li><p>/<br>repositories {<br>  google()<br>  jcenter()<br>}</p>
<p>/ <em>*      
</em>依赖关系块配置Gradle需要使用来构建项目的依赖项。以下行将Gradle 版本3.0.1的Android插件添加为类路径依赖项。    </p>
<ul>
<li><p>/<br>dependencies {<br>/<em>*坐标语法：‘group：name：version’ 指定所需的插件，并告诉Gradle在哪里找到它，各个 <code>:</code> 间的字段说明为：<br> 组 <code>com.android.tools.build</code><br> 名称 <code>gradle</code>名<br> 版本  <code>3.0.1</code>。  
</em>/    </p>
<p>classpath ‘com.android.tools.build:gradle:3.0.1’</p>
<p>// NOTE: Do not place your application dependencies here; they belong<br>// in the individual module build.gradle files<br>}<br>}</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>/ ** </p>
<ul>
<li>allprojects块是您配置 项目中所有模块使用的存储库和依赖项的位置，例如第三方插件或lib。</li>
<li>但是，您应该在 每个模块级别的build.gradle文件中配置模块特定的依赖项。</li>
<li><p>对于新项目， 默认情况下，Android Studio 包含JCenter和Google的Maven存储库，但不会 配置任何依赖关系。</p>
</li>
<li><p>对于包含多个模块的Android项目，在项目级别定义某些属性并在所有模块间共享它们可能会很有用。您可以通过向顶层文件中的块添加额外的属性来完成此操作。</p>
</li>
<li>额外属性：<a href="https://docs.gradle.org/current/userguide/writing_build_scripts.html#sec:extra_properties" target="_blank" rel="noopener">https://docs.gradle.org/current/userguide/writing_build_scripts.html#sec:extra_properties</a></li>
<li>/<br>allprojects {<br>  repositories {<pre><code>google()
jcenter()
</code></pre>  }<br>}</li>
</ul>
<p>// 特设任务<br>task clean(type: Delete) {<br>    delete rootProject.buildDir<br>}</p>
<p>/**</p>
<ul>
<li>自定义任务</li>
<li>注意：虽然Gradle允许您在模块级别定义项目范围的属性，但应该避免这样做，因为它会导致共享这些属性的模块被耦合。模块耦合使以后将模块作为独立项目导出变得更加困难<br>*/</li>
</ul>
<p>ext {<br>    compileSdkVersion = 26<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">在 **build.gradle(app)** 文件中调用 **`ext`** 时：</span><br></pre></td></tr></table></figure></p>
<p>android {<br>  // Use the following syntax to access properties you defined at the project level:<br>  // rootProject.ext.property_name<br>  compileSdkVersion rootProject.ext.compileSdkVersion<br>  …<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">### 2.3.2  Module 中的 build.gradle 文件</span><br></pre></td></tr></table></figure></p>
<p>/ ** </p>
<ul>
<li>构建配置中的第一行将Gradle 的Android插件应用于此构建，并使android块可用于指定Android特定的构建选项。</li>
<li>/<br>apply plugin: ‘com.android.application’</li>
</ul>
<p>/ **  </p>
<ul>
<li>android块是您配置所有Android特定构建选项的地方。 </li>
<li><p>/<br>android {<br>  compileSdkVersion 27<br>  / **    </p>
<ul>
<li>defaultConfig块封装所有构建变体的默认设置和条目</li>
<li>并且可以从构建系统动态地覆盖main/AndroidManifest.xml 中的一些属性</li>
<li><p>/<br>defaultConfig {<br>  / **      </p>
<ul>
<li>每个Android应用程序都有一个唯一的应用程序ID，applicationId </li>
<li>此ID在设备和Google Play商店中唯一标识您的应用，你永远不应该改变应用程序ID。  </li>
<li>应用程序ID 和 软件包名 彼此独立  </li>
<li>但是，您的源代码仍应引用 main/ AndroidManifest.xml文件中的包属性定义的包名。<br>*/<br>applicationId “com.esint.hellogradle”<br>//定义运行应用程序所需的最低API级别。<br>minSdkVersion 19<br>//指定用于测试应用程序的API级别。<br>targetSdkVersion 27<br>//定义您的应用程序的版本号。<br>versionCode 1<br>//为应用定义一个用户友好的版本名称。<br>versionName “1.0”<br>testInstrumentationRunner “android.support.test.runner.AndroidJUnitRunner”<br>}</li>
</ul>
<p>/ **    </p>
</li>
<li>buildTypes块是您可以配置多个构建类型的位置。</li>
<li>默认情况下，构建系统定义两种构建类型：调试和发布。</li>
<li>调试版本类型没有在默认已经明确显示，但它包含调试工具，并用调试密钥签名。</li>
<li><p>构建类型应用Proguard设置，并且默认情况下未进行签名。<br>*/<br>buildTypes {<br>  release {</p>
<pre><code>//为发布构建类型启用代码缩小。
minifyEnabled false
proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;
</code></pre><p>  }</p>
<p>  / **    </p>
<ul>
<li>productFlavors块是您可以配置多个产品风格的地方。这允许您创建不同版本的应用程序，可以用自己的设置覆盖defaultConfig块。</li>
<li>产品风格是可选的，构建系统默认不会创建它们。这个例子：</li>
<li>创建一个免费和付费的产品风格。然后指定每种产品风格自己的应用程序ID，以便它们可以同时存在于Google Play商店或Android设备上。</li>
<li><p>如果您使用Android插件3.0.0或更高版本，则还需要声明并将每种风味分配到风味维度。<br>*/<br>productFlavors {<br>  free {</p>
<pre><code>applicationId &apos;com.example.myapp.free&apos;
</code></pre><p>  }</p>
<p>  paid {</p>
<pre><code>applicationId &apos;com.example.myapp.paid&apos;
</code></pre><p>  }<br>}<br>/ **    </p>
<ul>
<li>分割块是您可以配置不同的APK构建的地方</li>
<li><p>每个仅包含支持屏幕密度或ABI的代码和资源。您还需要配置您的版本，以便每个APK具有不同的版本代码。<br>*/<br>splits {<br>//设置根据屏幕密度构建多个APK。<br>density {</p>
<p>  //启用或禁用构建多个APK。<br>  enable false</p>
<p>  //构建多个APK时排除这些密度。<br>  exclude “ldpi”, “tvdpi”, “xxxhdpi”, “400dpi”, “560dpi”<br>}<br>}<br>}<br>}</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>dependencies {<br>    implementation fileTree(dir: ‘libs’, include: [‘*.jar’])<br>    implementation ‘com.android.support:appcompat-v7:27.1.1’<br>    implementation ‘com.android.support.constraint:constraint-layout:1.1.0’<br>    testImplementation ‘junit:junit:4.12’<br>    androidTestImplementation ‘com.android.support.test:runner:1.0.2’<br>    androidTestImplementation ‘com.android.support.test.espresso:espresso-core:3.0.2’<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**配置文件块 - dependencies**</span><br></pre></td></tr></table></figure></p>
<p>dependencies {<br>    implementation fileTree(dir: ‘libs’, include: [‘*.jar’])<br>    implementation ‘com.android.support:appcompat-v7:27.1.1’<br>    implementation ‘com.android.support.constraint:constraint-layout:1.1.0’<br>    testImplementation ‘junit:junit:4.12’<br>    androidTestImplementation ‘com.android.support.test:runner:1.0.2’<br>    androidTestImplementation ‘com.android.support.test.espresso:espresso-core:3.0.2’<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**配置** `依赖关系`是构建Gradle应用程序的基础部分。在这种情况下，`dependencies`部分显示的值`implementation`，`testImplementation`和`androidTestImplementation`配置。</span><br><span class="line"></span><br><span class="line">- 最简单的一个，**`testImplementation`**依赖关系只包含最新的稳定JUnit 4发行版。JUnit类和测试注释将在编译时在`src/test/java`层次结构中可用。</span><br><span class="line">- 有三条线添加了对**`implementation`** 配置的依赖关系：</span><br><span class="line"></span><br><span class="line"> - 第一，`fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])`是一个 **fileTree依赖项**，它将文件libs夹中的所有jar文件添加到编译类路径中</span><br><span class="line"></span><br><span class="line"> - 第二，`com.android.support:appcompat-v7:26.1.0`将 **Android兼容性库** 添加到项目中。这使您可以在SDK版本7以前的任何Android应用程序中使用Material设计主题和其他功能。</span><br><span class="line"></span><br><span class="line"> - 第三，`com.android.support.constraint:constraint-layout:1.0.2`将Android约束布局添加到项目中。这使您可以在SDK版本9以前的任何Android应用程序中使用ConstraintLayout布局类。</span><br><span class="line"></span><br><span class="line">- `androidTestImplementation`依赖关系是指Espresso测试库，用于Android应用程序的集成测试。</span><br><span class="line"></span><br><span class="line">## 2.4 在终端中运行 Android 的 Gradle 命令</span><br><span class="line"></span><br><span class="line">在通过 Android Studio 构建和部署应用程序时，可以通过在 `终端中` 进入项目的根目录，在该目录下，运行：</span><br></pre></td></tr></table></figure></p>
<p>./gradlew build<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">这将运行许多任务，并最终返回“构建成功”。要查看生成的APK（Android包，Android应用的可部署版本），可看目录`app/build/outputs/apk`。在那里你会找到一个debug和一个release目录。该debug目录包含app-debug.apk将被部署到模拟器或连接设备的APK版本。如果您想部署发行版APK，则需要首先创建签名配置.</span><br></pre></td></tr></table></figure></p>
<p>./gradlew：app：dependencies –configuration releaseCompileClasspath </p>
<p>./gradlew：app：dependencyInsight –dependency support-annotations –configuration releaseCompileClasspath<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**注意：任何Gradle项目中都有 dependency 和 dependencyInsight 任务可用。它们可以帮助 追踪并解决与库版本冲突有关 的任何问题。**</span><br><span class="line"></span><br><span class="line">## 2.5 使用 Android Studio 中的 Gradle窗口</span><br><span class="line"></span><br><span class="line">Android Studio包含一个执行Gradle任务的特殊窗口。Android项目提供超过80种不同的任务，并且此窗口尝试将它们组织到不同的类别中。</span><br><span class="line"></span><br><span class="line">![](https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/Gradle-window-signingReport.png)</span><br><span class="line"></span><br><span class="line">可以通过此窗口，手动点击要执行的任务，查看在执行一种操作时，背后执行的具体tasks。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 2.6 Gradle调试</span><br><span class="line"></span><br><span class="line">### 2.6.1 日志输出（6种）</span><br><span class="line"></span><br><span class="line">-</span><br><span class="line">| 级别 | 描述  |</span><br><span class="line">| :-- | :-- |</span><br><span class="line">| ERROR | 错误消息 |</span><br><span class="line">| QUIET | 重要消息 |</span><br><span class="line">| WARNING | 警告消息 |</span><br><span class="line">| LIFECYCLE | 进度消息 |</span><br><span class="line">| INFO | 信息消息消息 |</span><br><span class="line">| DEBUG | 调试消息 |</span><br><span class="line"></span><br><span class="line">对于以上6种命令的使用，是通过 “命令行” 的方式来开启的</span><br></pre></td></tr></table></figure></p>
<h1 id="输出-INFO-级别之上的日志信息"><a href="#输出-INFO-级别之上的日志信息" class="headerlink" title="输出 INFO 级别之上的日志信息"></a>输出 INFO 级别之上的日志信息</h1><p>gradle -i build<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 2.6.2 错误输出</span><br></pre></td></tr></table></figure></p>
<h1 id="s-（精简部分信息）或者-S（信息最全）"><a href="#s-（精简部分信息）或者-S（信息最全）" class="headerlink" title="-s （精简部分信息）或者 -S（信息最全）"></a>-s （精简部分信息）或者 -S（信息最全）</h1><p>gradle -s build<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 2.6.3 使用信息调试</span><br><span class="line"></span><br><span class="line">- 通过 `print` 系列方法（QUIET级别）</span><br><span class="line">- 通过 `logger` （6种）</span><br><span class="line"></span><br><span class="line">### 2.7 gradle 命令</span><br><span class="line"></span><br><span class="line">- 多任务（task）调用</span><br></pre></td></tr></table></figure></p>
<h1 id="填写多个任务，各个任务之间通过-空格-进行分割"><a href="#填写多个任务，各个任务之间通过-空格-进行分割" class="headerlink" title="填写多个任务，各个任务之间通过 空格 进行分割"></a>填写多个任务，各个任务之间通过 空格 进行分割</h1><p>./gradlew  clean build<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 使用任务（task）名缩写执行调用</span><br></pre></td></tr></table></figure></p>
<p>./gradlew assembleD<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"># 3. Gradle 与 APK 的构建</span><br><span class="line"></span><br><span class="line">&gt; 参考：https://developer.android.com/studio/build/gradle-tips</span><br><span class="line"></span><br><span class="line">- **Gradle 运行过程**</span><br><span class="line"></span><br><span class="line"> - Initializatin：初始化</span><br><span class="line"> - Configuration：配置</span><br><span class="line"> - Execution：执行</span><br><span class="line"></span><br><span class="line">- **在构建App时，Gradle配置文件的执行过程：**</span><br><span class="line"></span><br><span class="line"> **`settings.gradle`**  -&gt; **`(Project)build.gradle`** -&gt; **`(Module)build.gradle`**  （可以使用 println()进行验证）</span><br><span class="line"> 即： **顺序执行** — **先运行 settings配置文件，再运行 Project，再运行 Module**。</span><br><span class="line"> </span><br><span class="line">## 3.1 applicationId</span><br><span class="line"></span><br><span class="line">### 3.1.1 applicationId 与 Java包名称</span><br><span class="line"> 每个Android应用程序都有一个唯一的应用程序ID，看起来像一个Java包名称，**此ID在设备和Google Play商店中唯一标识您的应用**。如果想上传应用程序的**新版本**，则应用程序ID（以及您对其签名的证书）**必须**与**原始APK相同**，如果更改应用程序ID，则Google Play Store会将APK视为完全不同的应用程序应用程序。所以一旦你发布你的应用程序，你永远不应该改变应用程序ID。</span><br><span class="line"> </span><br><span class="line">	当在 Android Studio中 创建新项目时，applicationId 与在安装过程中选择的 Java风格包名称完全匹配。</span><br><span class="line">	但是，除此之外， 应用程序ID 和 软件包名称 彼此独立。</span><br><span class="line">	可以更改代码的包名称（代码名称空间），它不会影响应用程序ID，反之亦然（但是，一旦发布应用程序，不应再更改您的应用程序ID）。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"> **命名规则：**</span><br><span class="line"> </span><br><span class="line"> - 它必须至少有两个部分（一个或多个点）。</span><br><span class="line"> - 每个部分必须以字母开头。</span><br><span class="line"> - 所有字符必须是字母数字或下划线[a-zA-Z0-9_]。</span><br><span class="line"></span><br><span class="line">**注意：**</span><br><span class="line"> applicationId用于 **直接绑定到代码的包名称** ; 所以一些Android API在其方法名称和参数名称中使用术语 **包名称** ，但这实际上是 **applicationId**。</span><br><span class="line"> </span><br><span class="line">### 3.1.2 更改 包名称 </span><br><span class="line"></span><br><span class="line">尽管默认情况下 **项目的包名称** 与 **应用程序ID** 相匹配，但可以更改它。如果要更改软件包名称，请注意**`软件包名称`（由项目目录结构定义）应始终与 `AndroidManifest.xml` 文件中的 `package` 属性匹配**</span><br></pre></td></tr></table></figure></p>
<p>&lt;?xml version=”1.0” encoding=”utf-8”?&gt;</p>
<p><manifest xmlns:android="http://schemas.android.com/apk/res/android" package="com.example.myapp" android:versioncode="1" android:versionname="1.0"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">gradle 使用这个 **package属性** 来做两件事情：</span><br><span class="line"></span><br><span class="line">- 将此名称用作应用程序生成的 **R.java类的名称空间** 。</span><br><span class="line"></span><br><span class="line"> 例子：通过上面的清单，R该类将会是 `com.example.myapp.R`。</span><br><span class="line"></span><br><span class="line">- 使用它来 **解析** 清单文件中声明的 **任何相关类名称**。</span><br><span class="line"></span><br><span class="line"> 示例：通过上面的清单，声明为 `&lt;activity android:name=&quot;.MainActivity&quot;&gt;` 已解析为 的活动为 `com.example.myapp.MainActivity`。</span><br><span class="line"></span><br><span class="line">### 3.1.3 一个参考示例： 更改applicationId - “免费”和“专业版”</span><br><span class="line"></span><br><span class="line">如果想创建不同版本的应用在Google Play商店中显示为**单独列表**，例如“**免费**”和“**专业版**”，则需要创建单独的构建变体，每个变体都具有不同的应用程序标识。</span><br><span class="line"></span><br><span class="line">在这种情况下，应该将**每个构建变体**定义为**独立的产品风格**。对于 productFlavors块内的每种风格，您可以**重新定义该 applicationId 属性**，或者可以使用以下代码段将缺省应用程序ID附加到一个段中applicationIdSuffix，如下所示：</span><br></pre></td></tr></table></figure></manifest></p>
<p>android {<br>    defaultConfig {<br>        applicationId “com.example.myapp”<br>    }<br>    productFlavors {<br>        free {<br>            applicationIdSuffix “.free”<br>        }<br>        pro {<br>            applicationIdSuffix “.pro”<br>        }<br>    }<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">这样，“免费”产品风格的应用程序ID是`com.example.myapp.free`。</span><br><span class="line"></span><br><span class="line">您也可以使用`applicationIdSuffix`基于您的**构建类型**添加细分，如下所示：</span><br></pre></td></tr></table></figure></p>
<p>android {<br>    …<br>    buildTypes {<br>        debug {<br>            applicationIdSuffix “.debug”<br>        }<br>    }<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">因为Gradle在 **产品风格** 之后应用了 **构建类型配置（debug、release）**，所以 **免费-调试版apk** 构建变体的 `applicationId` 现在是： **com.example.myapp.free.debug**。</span><br><span class="line"></span><br><span class="line">当希望将 **免费-调试版本apk** 和 **免费-发布版本apk** 构建在 **同一设备上**时，这非常有用，因为没有两个APK可以具有相同的应用程序ID。</span><br><span class="line"></span><br><span class="line">## 3.2 构建流程</span><br><span class="line"></span><br><span class="line">### 3.2.1 典型 APK 的构建流程</span><br><span class="line"> </span><br><span class="line">![](https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/build-process_2x.png)</span><br><span class="line"></span><br><span class="line">**注意**</span><br><span class="line"></span><br><span class="line">- 编译器 **源代码** 转换成 **DEX（Dalvik Executable) 文件**（其中包括运行在 Android 设备上的字节码），将所有**其他内容**转换成**已编译资源**。</span><br><span class="line">- APK 打包器将 DEX 文件和已编译资源 **合并** 成单个 **APK**。不过，**必须先签署 APK**，才能将应用**安装并部署**到 Android 设备上。</span><br><span class="line">- APK 打包器使用**调试或发布密钥库签署** APK：</span><br><span class="line"> - 如果您构建的是**调试版本的应用**（即专用于测试和分析的应用），打包器会**使用调试密钥库**签署您的应用。Android Studio 自动使用调试密钥库配置新项目。</span><br><span class="line"> - 如果您构建的是打算向外**发布的发布版本应用**，打包器会使用**发布密钥库签署**应用。要创建发布密钥库。</span><br><span class="line">- 在生成最终 APK 之前，打包器会**使用 zipalign 工具对应用进行优化，减少其在设备上运行时的内存占用**。</span><br><span class="line">- **task执行过程**：既可以执行 **单个task**，又可以将  **多个tasks串联执行** </span><br><span class="line"></span><br><span class="line">参照对应：**apk的打包流程图**</span><br><span class="line"></span><br><span class="line">![](https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/3606778-b978b976f8d0f591.png)</span><br><span class="line"></span><br><span class="line">在对 APK 执行具体的构建时，Gradle 运行的顺序为：</span><br></pre></td></tr></table></figure></p>
<p>settings.gradle -&gt; (Project)build.gradle -&gt; (Module)build.gradle -&gt; 所需的 Tasks<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">如图，执行 **assembleDebu** task 的过程：</span><br><span class="line"></span><br><span class="line">![](https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-07-14%2011.14.24.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 3.2.2 常用task</span><br><span class="line"></span><br><span class="line">- **assemble**</span><br><span class="line">- **clean**</span><br><span class="line">- **build**</span><br><span class="line">- **check**</span><br><span class="line">- **install**</span><br><span class="line"></span><br><span class="line">## 3.3 配置文件中几种常见的配置</span><br><span class="line"></span><br><span class="line">- **Build Types**</span><br><span class="line"></span><br><span class="line"> 构建类型定义了Gradle在**构建**和**打包应用程**序时使用的**特定属性**，并且通常针对开发生命周期的**不同阶段**进行配置。例如，</span><br><span class="line"></span><br><span class="line"> - 调试构建类型启用调试选项并使用调试密钥对APK进行签名，</span><br><span class="line"> - 发布构建类型可能会缩小、混淆并用发布密钥对APK进行签名进行分发。</span><br><span class="line"></span><br><span class="line"> 必须至少定义一种构建类型，才能构建应用程序。Android Studio默认创建 **调试** 和 **发布** 构建类型。</span><br><span class="line"></span><br><span class="line">- **Product Flavors**</span><br><span class="line"></span><br><span class="line"> `产品风格` 代表您可能发布给用户的不同版本的应用，例如免费和付费版本的应用。您可以自定义产品风格以使用不同的代码和资源，同时共享和重复使用适用于所有版本应用程序的通用部件。产品风格是可选的，须手动创建它们</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- **Manifest Entries**</span><br><span class="line"></span><br><span class="line">您可以在构建变体配置中为清单文件的某些属性指定值。这些构建值会 **覆盖清单文件中的现有值**。如果您希望为您的模块生成多个APK，其中每个apk文件都具有不同的应用程序名称，最低SDK版本或目标SDK版本</span><br><span class="line"></span><br><span class="line">- **Dependencies**</span><br><span class="line"></span><br><span class="line">构建系统从 **本地文件系统** 和 **远程存储库管理项目** 依赖关系。这样可以防止您必须手动搜索，下载和复制依赖关系的二进制包到项目目录中</span><br><span class="line"></span><br><span class="line">- **Signing**</span><br><span class="line"></span><br><span class="line">构建系统使您能够在构建配置中指定签名设置，并且可以在构建过程中自动签署APK。</span><br><span class="line"></span><br><span class="line">- **ProGuard**</span><br><span class="line"></span><br><span class="line">构建系统使您能够为每个构建变体指定不同的ProGuard规则文件。构建系统可以在构建过程中运行ProGuard来混淆你的类。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 3.4 依赖项：dependencies问题</span><br><span class="line"></span><br><span class="line">&gt; https://developer.android.com/studio/build/dependencies</span><br><span class="line">&gt; DSL参考：http://google.github.io/android-gradle-dsl/current/</span><br><span class="line"></span><br><span class="line">### 3.4.1 依赖的3种类型</span><br><span class="line"></span><br><span class="line">- **本地库模块依赖关系**</span><br></pre></td></tr></table></figure></p>
<p>compile project(“:mylibrary”)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- **本地依赖**</span><br></pre></td></tr></table></figure></p>
<p>compile fileTree(dir: ‘libs’, include: [‘*.jar’])<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- **远程依赖**</span><br></pre></td></tr></table></figure></p>
<p>compile ‘com.example.android:app-magic:12.3’<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 3.4.2 库依赖配置</span><br><span class="line"></span><br><span class="line">在dependencies块内部，可以使用几种不同的依赖配置之一来声明库依赖关系（如上compile所示）。每个依赖配置都提供了有关**如何使用该库的Gradle不同指导**。</span><br><span class="line"></span><br><span class="line">- **compile**</span><br><span class="line"></span><br><span class="line">Gradle将该依赖项**添加**到**编译类路径**和**APK中**。</span><br><span class="line"></span><br><span class="line">- **apk**</span><br><span class="line"></span><br><span class="line">Gradle只将相关性添加到APK（它不会被添加到编译类路径中）。</span><br><span class="line"></span><br><span class="line">- **provided**</span><br><span class="line"></span><br><span class="line">Gradle**仅将编译类路径**添加到编译类路径中（**它不会添加到APK中**）。这在创建Android库模块时非常有用， 并且在编译期间需要依赖关系，但在运行时存在此选项是可选的。也就是说，如果你使用这个配置，那么你的库模块必须包含一个运行时条件来检查依赖关系是否可用，然后适当地改变它的行为，以便它在没有提供时仍然可以运行。这有助于减少最终APK的大小，因为不会添加不重要的临时依赖项。</span><br><span class="line"></span><br><span class="line">**注意：**</span><br><span class="line">以上配置适用于项目的**主源集**，该集**适用于所有构建变体**。如果您不想为特定的构建变体源集或 测试源集声明一个依赖项 ，则必须**大写配置名称**，并在其前面加上构建变体或测试源集的名称。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1)  要**将compile依赖项仅添加到“免费”产品特征**（使用远程二进制依赖项），它看起来像这样：</span><br></pre></td></tr></table></figure></p>
<p>dependencies {<br>    freeCompile ‘com.google.firebase:firebase-ads:9.8.0’<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2) 如果要**为组合产品风格**和**构建类型的变体**添加依赖项，则必须在**configurations块**中初始化配置名称。以下示例将apk依赖项添加到“freeDebug”构建变体（使用本地二进制依赖项）：</span><br></pre></td></tr></table></figure></p>
<p>configurations {<br>    // Initializes a placeholder for the freeDebugApk dependency configuration.<br>    freeDebugApk {}<br>}</p>
<p>dependencies {<br>    freeDebugApk fileTree(dir: ‘libs’, include: [‘*.jar’])<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3) 要compile为您的**本地测试**和**仪器测试**添加依赖项，它看起来像这样：</span><br></pre></td></tr></table></figure></p>
<p>dependencies {<br>    // Adds a remote binary dependency only for local tests.<br>    testCompile ‘junit:junit:4.12’</p>
<pre><code>// Adds a remote binary dependency only for the instrumented test APK.
androidTestCompile &apos;com.android.support.test.espresso:espresso-core:3.0.2&apos;
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4) 如果你的**lib模块**提供了多种变体，你可以为不同的应用变体添加不同的lib变体，如下所示</span><br></pre></td></tr></table></figure></p>
<p>dependencies {<br>  // Adds the ‘debug’ variant of the library to the debug variant of the app<br>  debugCompile project(path: ‘:my-library-module’, configuration: ‘debug’)</p>
<p>  // Adds the ‘release’ variant of the library to the release variant of the app<br>  releaseCompile project(path: ‘:my-library-module’, configuration: ‘release’)<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 3.4.3 远程存储库</span><br><span class="line"></span><br><span class="line">当依赖项**不是本地库**或**文件树**时，Gradle会在文件`repositories块`中指定的任何联机存储库中查找这些 build.gradle文件。</span><br><span class="line"></span><br><span class="line">默认情况下，新的`Android Studio`项目将`JCenter`声明为项目顶层build.gradle文件中的存储库位置，如下所示：</span><br></pre></td></tr></table></figure></p>
<p>allprojects {<br>    repositories {<br>        jcenter()<br>    }<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">如果想从Maven中央存储库中获取某些内容，请添加 mavenCentral()或为本地存储库使用mavenLocal()：</span><br></pre></td></tr></table></figure></p>
<p>allprojects {<br>    repositories {<br>        jcenter()<br>        mavenCentral()<br>        mavenLocal()<br>    }<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">或者，可以按如下方式声明特定的Maven或Ivy存储库：</span><br></pre></td></tr></table></figure></p>
<p>allprojects {<br>    repositories {<br>        maven {<br>            url “<a href="https://repo.example.com/maven2" target="_blank" rel="noopener">https://repo.example.com/maven2</a>“<br>        }<br>        maven {<br>            url “file://local/repo/“<br>        }<br>        ivy {<br>            url “<a href="https://repo.example.com/ivy" target="_blank" rel="noopener">https://repo.example.com/ivy</a>“<br>        }<br>    }<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 3.4.4 Google的Maven存储库</span><br><span class="line"></span><br><span class="line">Google的Maven存储库提供了以下Android库的最新版本</span><br><span class="line"></span><br><span class="line">- Android Support Library</span><br><span class="line">- Architecture Components Library</span><br><span class="line">- Constraint Layout Library</span><br><span class="line">-  Android Test</span><br><span class="line">- Databinding Library</span><br><span class="line">- Android Instant App Library</span><br><span class="line">- Wear OS</span><br><span class="line">- Google Play services</span><br><span class="line">- Firebase</span><br><span class="line"></span><br><span class="line">要将这些库中的一个添加到您的版本中，请在您的顶级build.gradle文件中包含Google的Maven存储库</span><br></pre></td></tr></table></figure></p>
<p>allprojects {<br>    repositories {<br>        google()</p>
<pre><code>    // If you&apos;re using a version of Gradle lower than 4.1, you must instead use:
    // maven {
    //     url &apos;https://maven.google.com&apos;
    // }
    // An alternative URL is &apos;https://dl.google.com/dl/android/maven2/&apos;
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">然后将所需的库添加到您的模块的`dependencies块`。例如， `appcompat库` 看起来像这样：</span><br></pre></td></tr></table></figure></p>
<p>dependencies {<br>    compile ‘com.android.support:appcompat-v7:27.1.1’<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 3.4.5 依赖顺序</span><br><span class="line"></span><br><span class="line">第一个库的优先级高于第二个，第二个的优先级高于第三个，依此类推。在`资源合并`或 `清单元素`从库中合并到您的应用中时，此顺序非常重要 。</span><br><span class="line"></span><br><span class="line">例如，如果您的项目声明以下内容:</span><br><span class="line"></span><br><span class="line">	Dependency on LIB_A and LIB_B (依次)</span><br><span class="line">	And LIB_A depends on LIB_C and LIB_D (依次)</span><br><span class="line">	And LIB_B also depends on LIB_C</span><br><span class="line"></span><br><span class="line">然后，平面相关性顺序如下：</span><br><span class="line"></span><br><span class="line">	LIB_A</span><br><span class="line">	LIB_D</span><br><span class="line">	LIB_B</span><br><span class="line">	LIB_C</span><br><span class="line">	</span><br><span class="line">### 3.4.6 收缩代码</span><br><span class="line"></span><br><span class="line">要使用`ProGuard`缩小代码，`minifyEnabled true`</span><br><span class="line"></span><br><span class="line">请注意缩短代码会减慢构建时间，所以如果可能的话，应该避免在调试版本上使用它。</span><br></pre></td></tr></table></figure></p>
<p>android {<br>    buildTypes {<br>        release {<br>            minifyEnabled true<br>            proguardFiles getDefaultProguardFile(‘proguard-android.txt’), ‘proguard-rules.pro’<br>        }<br>    }<br>    …<br>}<br>```</p>
<p><strong>注意：</strong>使用<code>Instant Run</code>时，Android Studio会禁用<code>ProGuard</code>。</p>

      
    </div>
    
    
    

    

    


    <footer class="post-footer">
      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/温故知新-数据结构-算法复杂度/" rel="next" title="温故知新-数据结构-算法复杂度">
                <i class="fa fa-chevron-left"></i> 温故知新-数据结构-算法复杂度
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/Android aar/" rel="prev" title="Android-aar">
                Android-aar <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="http://oy991qm3u.bkt.clouddn.com/%E6%A2%B5%E9%AB%98.gif" alt="YannisCheng">
            
              <p class="site-author-name" itemprop="name">YannisCheng</p>
              <p class="site-description motion-element" itemprop="description">不必一味的讨好别人，每个人都有自己的活法。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">174</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">74</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/YannisCheng" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:cwj1714@163.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-Gradle概述"><span class="nav-number">1.</span> <span class="nav-text">1. Gradle概述</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-安装"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-1-前提条件"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.1.1 前提条件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-2-安装"><span class="nav-number">1.1.2.</span> <span class="nav-text">1.1.2 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-3-验证安装"><span class="nav-number">1.1.3.</span> <span class="nav-text">1.1.3 验证安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-创建新的Gradle项目"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 创建新的Gradle项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-1-创建一个新的目录"><span class="nav-number">1.2.1.</span> <span class="nav-text">1.2.1 创建一个新的目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-2-初始化项目"><span class="nav-number">1.2.2.</span> <span class="nav-text">1.2.2 初始化项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-3-创建一个新任务"><span class="nav-number">1.2.3.</span> <span class="nav-text">1.2.3 创建一个新任务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-4-应用一个插件"><span class="nav-number">1.2.4.</span> <span class="nav-text">1.2.4 应用一个插件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-5-发现更多的可用-task"><span class="nav-number">1.2.5.</span> <span class="nav-text">1.2.5 发现更多的可用 task</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-命令"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-1-一般命令："><span class="nav-number">1.3.1.</span> <span class="nav-text">1.3.1 一般命令：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-2-执行任务"><span class="nav-number">1.3.2.</span> <span class="nav-text">1.3.2 执行任务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-3-常用-Task"><span class="nav-number">1.3.3.</span> <span class="nav-text">1.3.3 常用 Task</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-4-项目信息-Task"><span class="nav-number">1.4.</span> <span class="nav-text">1.3.4 项目信息 Task</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-Gradle-与-Android-Studio-结合"><span class="nav-number">2.</span> <span class="nav-text">2. Gradle 与 Android Studio 结合</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-Gradle-Wrapper"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 Gradle Wrapper</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-1-生成-Wrapper"><span class="nav-number">2.1.1.</span> <span class="nav-text">2.1.1 生成 Wrapper</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#输出-INFO-级别之上的日志信息"><span class="nav-number">3.</span> <span class="nav-text">输出 INFO 级别之上的日志信息</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#s-（精简部分信息）或者-S（信息最全）"><span class="nav-number">4.</span> <span class="nav-text">-s （精简部分信息）或者 -S（信息最全）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#填写多个任务，各个任务之间通过-空格-进行分割"><span class="nav-number">5.</span> <span class="nav-text">填写多个任务，各个任务之间通过 空格 进行分割</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">YannisCheng</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">410.5k</span>
  
</div>













        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  
  


  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.3"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.3"></script>


  


<script type="text/javascript" color="18,146,19" opacity="0.7" zindex="-1" count="0" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script>

</body>
</html>
