<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">






  
  
  <link rel="stylesheet" media="all" href="/lib/Han/dist/han.min.css?v=3.3">




<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Android,è“ç‰™,">










<meta name="description" content="å‚è€ƒæ–‡ç« ï¼šhttps://www.jianshu.com/p/3a372af38103å‚è€ƒæ–‡ç« ï¼šhttps://www.jianshu.com/p/29a730795294android developersï¼šhttps://developer.android.google.cn/guide/topics/connectivity/bluetooth-le.html#termséƒ¨åˆ†å›¾ç‰‡æ¥æºï¼šht">
<meta name="keywords" content="Android,è“ç‰™">
<meta property="og:type" content="article">
<meta property="og:title" content="Android BLE è“ç‰™å¼€å‘">
<meta property="og:url" content="http://yannischeng.com/Android BLE è“ç‰™å¼€å‘/index.html">
<meta property="og:site_name" content="YannisCheng&#39;s Technology Blogs">
<meta property="og:description" content="å‚è€ƒæ–‡ç« ï¼šhttps://www.jianshu.com/p/3a372af38103å‚è€ƒæ–‡ç« ï¼šhttps://www.jianshu.com/p/29a730795294android developersï¼šhttps://developer.android.google.cn/guide/topics/connectivity/bluetooth-le.html#termséƒ¨åˆ†å›¾ç‰‡æ¥æºï¼šht">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-02-06%2009.29.46.png">
<meta property="og:image" content="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/4985212-4eb4addccb3fe853.png">
<meta property="og:image" content="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/1806858-265d374ad9bb425f.png">
<meta property="og:image" content="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-02-02%2010.10.05.png">
<meta property="og:image" content="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-02-02%2010.11.50.png">
<meta property="og:updated_time" content="2018-11-20T13:04:37.080Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android BLE è“ç‰™å¼€å‘">
<meta name="twitter:description" content="å‚è€ƒæ–‡ç« ï¼šhttps://www.jianshu.com/p/3a372af38103å‚è€ƒæ–‡ç« ï¼šhttps://www.jianshu.com/p/29a730795294android developersï¼šhttps://developer.android.google.cn/guide/topics/connectivity/bluetooth-le.html#termséƒ¨åˆ†å›¾ç‰‡æ¥æºï¼šht">
<meta name="twitter:image" content="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-02-06%2009.29.46.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yannischeng.com/Android BLE è“ç‰™å¼€å‘/">





  <title>Android BLE è“ç‰™å¼€å‘ | YannisCheng's Technology Blogs</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta custom-logo">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">YannisCheng's Technology Blogs</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ä¸å¿…ä¸€å‘³çš„è®¨å¥½åˆ«äººï¼Œæ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„æ´»æ³•ã€‚</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            å…³äº
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yannischeng.com/Android BLE è“ç‰™å¼€å‘/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="YannisCheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="http://oy991qm3u.bkt.clouddn.com/%E6%A2%B5%E9%AB%98.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YannisCheng's Technology Blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Android BLE è“ç‰™å¼€å‘</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-02-01T22:17:04+08:00">
                2018-02-01
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">æ›´æ–°äº&#58;</span>
              
              <time title="æ›´æ–°äº" itemprop="dateModified" datetime="2018-11-20T21:04:37+08:00">
                2018-11-20
              </time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡&#58;</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  4,907 å­—
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  21 åˆ†é’Ÿ
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    

    
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag"># Android</a>
          
            <a href="/tags/è“ç‰™/" rel="tag"># è“ç‰™</a>
          
        </div>
      

    
    
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š</strong>
    YannisCheng
  </li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="http://yannischeng.com/Android BLE è“ç‰™å¼€å‘/" title="Android BLE è“ç‰™å¼€å‘">http://yannischeng.com/Android BLE è“ç‰™å¼€å‘/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>
    å°Šé‡ä¸ªäººåŠ³åŠ¨æˆæœï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ â”€=â‰¡Î£(((ã¤â€¢Ì€Ï‰â€¢Ì)ã¤))
  </li>
</ul>

      </div>
    



    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        <blockquote>
<p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.jianshu.com/p/3a372af38103" target="_blank" rel="noopener">https://www.jianshu.com/p/3a372af38103</a><br>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.jianshu.com/p/29a730795294" target="_blank" rel="noopener">https://www.jianshu.com/p/29a730795294</a><br>android developersï¼š<a href="https://developer.android.google.cn/guide/topics/connectivity/bluetooth-le.html#terms" target="_blank" rel="noopener">https://developer.android.google.cn/guide/topics/connectivity/bluetooth-le.html#terms</a><br>éƒ¨åˆ†å›¾ç‰‡æ¥æºï¼š<a href="https://www.youtube.com/watch?v=vUbFB1Qypg8" target="_blank" rel="noopener">https://www.youtube.com/watch?v=vUbFB1Qypg8</a><br>ç»å…¸è“ç‰™ä½¿ç”¨å‚è€ƒï¼š<a href="http://blog.csdn.net/axinmeng88/article/details/79059468" target="_blank" rel="noopener">http://blog.csdn.net/axinmeng88/article/details/79059468</a><br>BLEè®¾å¤‡åœ°å€å‚è€ƒï¼š<a href="http://www.wowotech.net/bluetooth/ble_address_type.html" target="_blank" rel="noopener">http://www.wowotech.net/bluetooth/ble_address_type.html</a></p>
</blockquote>
<a id="more"></a>
<h1 id="è“ç‰™å”¯ä¸€èº«ä»½æ ‡è¯†"><a href="#è“ç‰™å”¯ä¸€èº«ä»½æ ‡è¯†" class="headerlink" title="è“ç‰™å”¯ä¸€èº«ä»½æ ‡è¯†"></a>è“ç‰™å”¯ä¸€èº«ä»½æ ‡è¯†</h1><ul>
<li><strong>MACåœ°å€</strong>ï¼šè¿™ä¸ªåœ°å€æ˜¯å”¯ä¸€çš„ï¼Œå°±åƒç½‘ç»œä¸Šçš„<strong>IPåœ°å€</strong></li>
</ul>
<p><img src="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-02-06%2009.29.46.png" alt></p>
<p><strong>UUIDï¼ˆUniversally Unique Identifierï¼‰</strong>ï¼šå¯ä»¥æŠŠå®ƒç†è§£ä¸ºæ˜¯IPåœ°å€ä¸­çš„<strong>ç«¯å£å·</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ›´å¤šUUIDæ¥å£å‚è€ƒï¼šhttps://www.jianshu.com/p/3de46c75f8ceï¼Œ</span><br><span class="line">å®˜ç½‘ï¼šhttps://www.bluetooth.com/zh-cn/specifications/assigned-numbers/service-discovery</span><br></pre></td></tr></table></figure>
<p><strong>MAC + UUID = IPåœ°å€ + ç«¯å£å·</strong>ã€‚è¿™ä¸¤è€…åˆèµ·æ¥å°±æ˜¯è“ç‰™çš„å”¯ä¸€èº«ä»½æ ‡è¯†ã€‚BLEæ‰«æçš„è¿‡ç¨‹ï¼Œè®¾å¤‡ä¼šç”Ÿæˆéšæœºåœ°å€ã€‚æ ¹æ®éšæœºåœ°å€ä¹Ÿèƒ½è¿›è¡Œè¿æ¥ã€‚</p>
<h1 id="BLE-Bluetooth-Low-Energy-ä½åŠŸè€—è“ç‰™"><a href="#BLE-Bluetooth-Low-Energy-ä½åŠŸè€—è“ç‰™" class="headerlink" title="BLE (Bluetooth Low Energy) ä½åŠŸè€—è“ç‰™"></a>BLE (Bluetooth Low Energy) ä½åŠŸè€—è“ç‰™</h1><p>Android 4.3ï¼ˆAPIçº§åˆ«18ï¼‰å¼•å…¥äº†ä»¥ä½åŠŸè€—è“ç‰™ï¼ˆBLEï¼‰ä¸ºä¸­å¿ƒè§’è‰²çš„å†…ç½®å¹³å°æ”¯æŒï¼Œå¹¶æä¾›åº”ç”¨ç¨‹åºå¯ç”¨äºå‘ç°è®¾å¤‡ï¼ŒæŸ¥è¯¢æœåŠ¡å’Œä¼ è¾“ä¿¡æ¯çš„API</p>
<p>å¸¸è§ç”¨ä¾‹åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>åœ¨é™„è¿‘çš„è®¾å¤‡ä¹‹é—´ä¼ è¾“å°‘é‡çš„æ•°æ®</li>
<li>ä¸Google Beaconsç­‰æ¥è¿‘ä¼ æ„Ÿå™¨è¿›è¡Œäº’åŠ¨ï¼Œä¸ºç”¨æˆ·æä¾›åŸºäºå½“å‰ä½ç½®çš„å®šåˆ¶ä½“éªŒã€‚</li>
</ul>
<p>ä¼ ç»Ÿè“ç‰™å¯ä»¥ç”¨äºæ•°æ®é‡æ¯”è¾ƒå¤§çš„ä¼ è¾“ï¼Œå¦‚è¯­éŸ³ï¼ŒéŸ³ä¹ï¼Œè¾ƒé«˜æ•°æ®é‡ä¼ è¾“ç­‰ï¼Œä½†æ˜¯æ¯”è¾ƒè€—ç”µï¼Œä½åŠŸè€—è“ç‰™è¿™æ ·åº”ç”¨äºå®æ—¶æ€§è¦æ±‚æ¯”è¾ƒé«˜ï¼ŒåŠŸè€—æ¯”è¾ƒä½ï¼Œä½†æ˜¯æ•°æ®é€Ÿç‡æ¯”è¾ƒä½çš„äº§å“ï¼Œå¦‚é¥æ§ç±»çš„ï¼Œå¦‚é¼ æ ‡ï¼Œé”®ç›˜ï¼Œé¥æ§é¼ æ ‡(Air Mouse)ï¼Œä¼ æ„Ÿè®¾å¤‡çš„æ•°æ®å‘é€ï¼Œå¦‚å¿ƒè·³å¸¦ï¼Œè¡€å‹è®¡ï¼Œæ¸©åº¦ä¼ æ„Ÿå™¨ç­‰ã€‚</p>
<h1 id="å…³é”®æœ¯è¯­ï¼ˆKey-Termsï¼‰å’Œ-æ¦‚å¿µï¼ˆConceptsï¼‰"><a href="#å…³é”®æœ¯è¯­ï¼ˆKey-Termsï¼‰å’Œ-æ¦‚å¿µï¼ˆConceptsï¼‰" class="headerlink" title="å…³é”®æœ¯è¯­ï¼ˆKey Termsï¼‰å’Œ æ¦‚å¿µï¼ˆConceptsï¼‰"></a>å…³é”®æœ¯è¯­ï¼ˆKey Termsï¼‰å’Œ æ¦‚å¿µï¼ˆConceptsï¼‰</h1><p><img src="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/4985212-4eb4addccb3fe853.png" alt></p>
<p>GATTå›¾ç¤º1</p>
<p><img src="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/1806858-265d374ad9bb425f.png" alt></p>
<p>GATTå›¾ç¤º2</p>
<ul>
<li><p><strong>é€šç”¨å±æ€§é…ç½®æ–‡ä»¶ Generic Attribute Profileï¼ˆGATTï¼‰</strong>ï¼šGATTé…ç½®æ–‡ä»¶æ˜¯é€šè¿‡BLEé“¾æ¥å‘é€å’Œæ¥æ”¶è¢«ç§°ä¸ºâ€œå±æ€§â€çš„çŸ­å°æ•°æ®çš„é€šç”¨è§„èŒƒã€‚ç›®å‰æ‰€æœ‰çš„ä½èƒ½è€—åº”ç”¨ç¨‹åºéƒ½åŸºäºGATTã€‚</p>
<ul>
<li>è“ç‰™SIGä¸ºä½èƒ½è€—è®¾å¤‡å®šä¹‰äº†è®¸å¤šé…ç½®æ–‡ä»¶ã€‚ é…ç½®æ–‡ä»¶æ˜¯è®¾å¤‡å¦‚ä½•åœ¨ç‰¹å®šåº”ç”¨ç¨‹åºä¸­å·¥ä½œçš„è§„èŒƒã€‚ è¯·æ³¨æ„ï¼Œè®¾å¤‡å¯ä»¥å®ç°å¤šä¸ªé…ç½®æ–‡ä»¶ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªè®¾å¤‡å¯ä»¥åŒ…å«ä¸€ä¸ªå¿ƒç‡ç›‘æµ‹å™¨å’Œä¸€ä¸ªç”µæ± ç”µé‡æ£€æµ‹å™¨ã€‚</li>
<li><p>ä½ å¯ä»¥æŠŠä»–çœ‹æˆxmlæ¥ç†è§£ï¼š</p>
<ul>
<li>æ¯ä¸ªGATTç”±å®Œæˆä¸åŒåŠŸèƒ½çš„Serviceç»„æˆï¼›</li>
<li>æ¯ä¸ªServiceç”±ä¸åŒçš„Characteristicç»„æˆï¼›</li>
<li><p>æ¯ä¸ªCharacteristicç”±ä¸€ä¸ªvalueå’Œä¸€ä¸ªæˆ–è€…å¤šä¸ªDescriptorç»„æˆï¼›</p>
<p>Serviceã€Characteristicç›¸å½“äºæ ‡ç­¾ï¼ˆServiceç›¸å½“äºä»–çš„ç±»åˆ«ï¼ŒCharacteristicç›¸å½“äºå®ƒçš„åå­—ï¼‰ï¼Œè€Œvalueæ‰çœŸæ­£çš„åŒ…å«æ•°æ®ï¼ŒDescriptoræ˜¯å¯¹è¿™ä¸ªvalueè¿›è¡Œçš„è¯´æ˜å’Œæè¿°ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥ä»ä¸åŒè§’åº¦æ¥æè¿°å’Œè¯´æ˜ï¼Œå› æ­¤å¯ä»¥æœ‰å¤šä¸ªDescriptor.</p>
<p><strong>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­è¿›è¡Œè¯´æ˜ï¼š</strong></p>
<p>å¸¸è§çš„å°ç±³æ‰‹ç¯æ˜¯ä¸€ä¸ªBLEè®¾å¤‡ï¼Œï¼ˆå‡è®¾ï¼‰å®ƒåŒ…å«ä¸‰ä¸ªService,åˆ†åˆ«æ˜¯æä¾›è®¾å¤‡ä¿¡æ¯çš„Serviceã€æä¾›æ­¥æ•°çš„Serviceã€æ£€æµ‹å¿ƒç‡çš„Service;<br>è€Œè®¾å¤‡ä¿¡æ¯çš„serviceä¸­åŒ…å«çš„characteristicåŒ…æ‹¬å‚å•†ä¿¡æ¯ã€ç¡¬ä»¶ä¿¡æ¯ã€ç‰ˆæœ¬ä¿¡æ¯ç­‰ï¼›è€Œå¿ƒç‡Serviceåˆ™åŒ…æ‹¬å¿ƒç‡characteristicç­‰ï¼Œè€Œå¿ƒç‡characteristicä¸­çš„valueåˆ™çœŸæ­£çš„åŒ…å«å¿ƒç‡çš„æ•°æ®ï¼Œè€Œdescriptoråˆ™æ˜¯å¯¹è¯¥valueçš„æè¿°è¯´æ˜ï¼Œæ¯”å¦‚valueçš„å•ä½å•Šï¼Œæè¿°å•Šï¼Œæƒé™å•Šç­‰ã€‚</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><strong>å±æ€§åè®® Attribute Protocolï¼ˆATTï¼‰</strong>ï¼šGATTå»ºç«‹åœ¨å±æ€§åè®®ï¼ˆATTï¼‰ä¹‹ä¸Šã€‚ è¿™ä¹Ÿè¢«ç§°ä¸ºGATT / ATTã€‚ ATTç»è¿‡ä¼˜åŒ–ï¼Œå¯åœ¨BLEè®¾å¤‡ä¸Šè¿è¡Œã€‚ ä¸ºæ­¤ï¼Œå®ƒä½¿ç”¨å°½å¯èƒ½å°‘çš„å­—èŠ‚ã€‚ æ¯ä¸ªå±æ€§ç”±ä¸€ä¸ª<strong>é€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆUUIDï¼‰</strong>å”¯ä¸€æ ‡è¯†ï¼Œè¯¥æ ‡è¯†ç¬¦æ˜¯ç”¨äºå”¯ä¸€æ ‡è¯†ä¿¡æ¯çš„å­—ç¬¦ä¸²IDçš„æ ‡å‡†åŒ–128ä½æ ¼å¼ã€‚ ATTä¼ è¾“çš„å±æ€§è¢«æ ¼å¼åŒ–ä¸ºç‰¹å¾å’ŒæœåŠ¡ã€‚</li>
<li><strong>ç‰¹æ€§ Characteristic</strong>ï¼š ç‰¹æ€§åŒ…å«æè¿°ç‰¹æ€§å€¼çš„å•ä¸ªå€¼å’Œ0-nä¸ªæè¿°ç¬¦ã€‚ä¸€ä¸ªç‰¹å¾å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªç±»ï¼Œç±»ä¼¼äºä¸€ä¸ªé˜¶çº§ã€‚æ˜¯æœ€å°çš„æ•°æ®é€»è¾‘å•å…ƒã€‚</li>
<li><strong>æè¿°ç¬¦ Descriptor</strong>ï¼š æè¿°ç¬¦æ˜¯æè¿°ç‰¹å¾å€¼çš„å®šä¹‰å±æ€§ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªæè¿°ç¬¦å¯ä»¥æŒ‡å®šä¸€ä¸ªå¯è¯»çš„æè¿°ï¼Œä¸€ä¸ªç‰¹å¾å€¼çš„å¯æ¥å—èŒƒå›´ï¼Œæˆ–è€…ä¸€ä¸ªç‰¹å¾å€¼ç‰¹æœ‰çš„åº¦é‡å•ä½ã€‚valueã€descriptorä¸­å­˜å‚¨æ•°æ®çš„è§£æç”±Serverçš„å·¥ç¨‹å¸ˆå†³å®šï¼Œå¹¶æ— è§„èŒƒï¼ŒåŒå‘æŒ‰ç…§çº¦å®šå¼€å‘ã€‚</li>
<li><strong>æœåŠ¡ Service</strong>ï¼š æœåŠ¡æ˜¯ä¸€ä¸ªç‰¹å¾çš„é›†åˆã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªåä¸ºâ€œå¿ƒç‡ç›‘æµ‹å™¨â€çš„æœåŠ¡ï¼Œå…¶ä¸­åŒ…å«â€œå¿ƒç‡æµ‹é‡â€ç­‰ç‰¹æ€§ã€‚ æ‚¨å¯ä»¥åœ¨bluetooth.orgä¸Šæ‰¾åˆ°ç°æœ‰åŸºäºGATTçš„é…ç½®æ–‡ä»¶å’ŒæœåŠ¡çš„åˆ—è¡¨ã€‚Service/Characteristicå‡æœ‰ä¸€ä¸ª<strong>å”¯ä¸€çš„UUIDæ ‡è¯†</strong>ï¼ŒUUIDæ—¢æœ‰<strong>16ä½</strong>çš„ä¹Ÿæœ‰<strong>128ä½</strong>çš„ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£çš„æ˜¯16ä½çš„UUIDæ˜¯ç»è¿‡è“ç‰™ç»„ç»‡è®¤è¯çš„ï¼Œæ˜¯éœ€è¦è´­ä¹°çš„ï¼Œå½“ç„¶ä¹Ÿæœ‰ä¸€äº›é€šç”¨çš„16ä½UUIDã€‚ä¾‹å¦‚<strong>Heart Rate</strong>æœåŠ¡çš„UUIDå°±æ˜¯0X180D,ä»£ç ä¸­è¡¨ç¤ºä¸º0X00001800-0000-1000-8000-00805f9b34fb,å…¶ä»–ä½ä¸ºå›ºå®šçš„ã€‚è€Œ128ä½çš„UUIDåˆ™å¯ä»¥è‡ªå®šä¹‰ã€‚</li>
</ul>
<h1 id="è§’è‰²ï¼ˆRolesï¼‰å’Œè´£ä»»ï¼ˆResponsibilitiesï¼‰"><a href="#è§’è‰²ï¼ˆRolesï¼‰å’Œè´£ä»»ï¼ˆResponsibilitiesï¼‰" class="headerlink" title="è§’è‰²ï¼ˆRolesï¼‰å’Œè´£ä»»ï¼ˆResponsibilitiesï¼‰"></a>è§’è‰²ï¼ˆRolesï¼‰å’Œè´£ä»»ï¼ˆResponsibilitiesï¼‰</h1><p>ä»¥ä¸‹æ˜¯Androidè®¾å¤‡ä¸BLEè®¾å¤‡äº¤äº’æ—¶é€‚ç”¨çš„è§’è‰²å’ŒèŒè´£ï¼š</p>
<ul>
<li><strong>ä¸­å¤®ï¼ˆCentralï¼‰</strong> ä¸ <strong>å‘¨è¾¹ï¼ˆPeripheralï¼‰</strong>ã€‚è¿™é€‚ç”¨äºBLEè¿æ¥æœ¬èº«ã€‚å¤„äºä¸­å¿ƒè§’è‰²çš„è®¾å¤‡æ‰«æï¼Œå¯»æ‰¾å¹¿å‘Šï¼Œå¹¶ä¸”åœ¨å¤–å›´è§’è‰²ä¸­çš„è®¾å¤‡è¿›è¡Œå¹¿å‘Šã€‚</li>
<li><strong>GATTæœåŠ¡å™¨</strong> ä¸ <strong>GATTå®¢æˆ·ç«¯</strong>ã€‚è¿™å†³å®šäº†ä¸¤å°è®¾å¤‡åœ¨å»ºç«‹è¿æ¥åå¦‚ä½•ç›¸äº’é€šè¯ã€‚</li>
</ul>
<p><img src="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-02-02%2010.10.05.png" alt></p>
<p>ä¸ºäº†ç†è§£è¿™ä¸ªåŒºåˆ«ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªAndroidæ‰‹æœºå’Œä¸€ä¸ªBLEè®¾å¤‡çš„æ´»åŠ¨è¿½è¸ªå™¨ã€‚ æ‰‹æœºæ”¯æŒä¸­å¿ƒè§’è‰²; æ´»åŠ¨è·Ÿè¸ªå™¨æ”¯æŒå¤–è®¾è§’è‰²ï¼ˆå»ºç«‹ä¸€ä¸ªBLEè¿æ¥ï¼Œä½ éœ€è¦æ¯ä¸¤ä¸ªäº‹ç‰©ä¸­åªæœ‰ä¸€ä¸ªæ”¯æŒå¤–å›´è®¾å¤‡çš„äººä¸èƒ½å½¼æ­¤äº¤è°ˆï¼Œä¹Ÿä¸èƒ½åªæ”¯æŒä¸¤ä¸ªäº‹ç‰©ï¼‰ã€‚</p>
<p>ä¸€æ—¦æ‰‹æœºå’Œæ´»åŠ¨è¿½è¸ªå™¨å»ºç«‹äº†è¿æ¥ï¼Œä»–ä»¬å°±å¼€å§‹å°†GATTå…ƒæ•°æ®è½¬ç§»åˆ°å¦ä¸€ä¸ªã€‚æ ¹æ®ä»–ä»¬ä¼ è¾“çš„æ•°æ®çš„ç§ç±»ï¼Œå…¶ä¸­ä¸€ä¸ªæˆ–å¦ä¸€ä¸ªå¯èƒ½å……å½“æœåŠ¡å™¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ´»åŠ¨è·Ÿè¸ªå™¨æƒ³è¦å°†ä¼ æ„Ÿå™¨æ•°æ®æŠ¥å‘Šç»™ç”µè¯ï¼Œåˆ™æ´»åŠ¨è·Ÿè¸ªå™¨å¯ä»¥å……å½“æœåŠ¡å™¨ã€‚å¦‚æœæ´»åŠ¨è·Ÿè¸ªå™¨æƒ³è¦ä»æ‰‹æœºæ¥æ”¶æ›´æ–°ï¼Œé‚£ä¹ˆæ‰‹æœºä½œä¸ºæœåŠ¡å™¨å¯èƒ½æ˜¯æœ‰æ„ä¹‰çš„ã€‚</p>
<p>åœ¨æœ¬æ–‡æ¡£ä¸­ä½¿ç”¨çš„ç¤ºä¾‹ä¸­ï¼ŒAndroidåº”ç”¨ç¨‹åºï¼ˆåœ¨Androidè®¾å¤‡ä¸Šè¿è¡Œï¼‰æ˜¯GATTå®¢æˆ·ç«¯ã€‚è¯¥åº”ç”¨ç¨‹åºä»GATTæœåŠ¡å™¨è·å–æ•°æ®ï¼ŒGATTæœåŠ¡å™¨æ˜¯æ”¯æŒå¿ƒç‡æ¡£æ¡ˆçš„BLEå¿ƒç‡ç›‘æµ‹å™¨ã€‚ä½†ä½ ä¹Ÿå¯ä»¥è®¾è®¡ä½ çš„Androidåº”ç”¨ç¨‹åºæ¥æ‰®æ¼”GATTæœåŠ¡å™¨çš„è§’è‰²ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…BluetoothGattServerã€‚</p>
<h1 id="BLE-æƒé™ï¼ˆPermissionsï¼‰"><a href="#BLE-æƒé™ï¼ˆPermissionsï¼‰" class="headerlink" title="BLE æƒé™ï¼ˆPermissionsï¼‰"></a>BLE æƒé™ï¼ˆPermissionsï¼‰</h1><ul>
<li><p>ä¸ºäº†åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è“ç‰™åŠŸèƒ½ï¼Œæ‚¨å¿…é¡»å£°æ˜ï¼ˆdeclareï¼‰ <strong>æƒé™1ï¼šBLUETOOTH</strong>ã€‚æ‚¨éœ€è¦æ­¤æƒé™æ‰èƒ½æ‰§è¡Œï¼ˆperformï¼‰ä»»ä½• <strong>è“ç‰™é€šä¿¡</strong> ï¼Œä¾‹å¦‚ è¯·æ±‚è¿æ¥ï¼Œæ¥å—è¿æ¥ä»¥åŠä¼ è¾“æ•°æ®ã€‚</p>
</li>
<li><p>å¦‚æœæ‚¨å¸Œæœ›æ‚¨çš„åº”ç”¨å¯åŠ¨è®¾å¤‡<strong>å‘ç°æˆ–æ“çºµï¼ˆmanipulateï¼‰è“ç‰™è®¾ç½®</strong>ï¼Œåˆ™è¿˜å¿…é¡»å£°æ˜ <strong>æƒé™2ï¼šBLUETOOTH_ADMIN</strong>ã€‚ æ³¨æ„ï¼šå¦‚æœæ‚¨ä½¿ç”¨BLUETOOTH_ADMINæƒé™ï¼Œåˆ™è¿˜å¿…é¡»å…·æœ‰BLUETOOTHæƒé™ã€‚</p>
</li>
</ul>
<p>åœ¨åº”ç”¨ç¨‹åºæ¸…å•æ–‡ä»¶ä¸­å£°æ˜è“ç‰™è®¸å¯ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=&quot;android.permission.BLUETOOTH&quot;/&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.BLUETOOTH_ADMIN&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ‚¨æƒ³å£°æ˜æ‚¨çš„åº”ç”¨<strong>ä»…é€‚ç”¨äºå…·æœ‰BLEåŠŸèƒ½çš„è®¾å¤‡</strong>ï¼Œè¯·åœ¨åº”ç”¨çš„æ¸…å•ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-feature android:name=&quot;android.hardware.bluetooth_le&quot; android:required=&quot;true&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æƒ³è®©æ‚¨çš„åº”ç”¨å¯ç”¨äºä¸æ”¯æŒBLEçš„è®¾å¤‡ï¼Œåˆ™åº”è¯¥åœ¨åº”ç”¨çš„æ¸…å•ä¸­åŒ…å«æ­¤å…ƒç´ ï¼Œä½†è®¾ç½®<code>required =â€œfalseâ€</code>ã€‚ ç„¶ååœ¨è¿è¡Œæ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>PackageManager.hasSystemFeatureï¼ˆï¼‰</code>æ¥ç¡®å®šBLEå¯ç”¨æ€§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// Use this check to determine whether BLE is supported on the device. Then</span><br><span class="line">// you can selectively disable BLE-related features.</span><br><span class="line">if (!getPackageManager().hasSystemFeature(PackageManager.FEATURE_BLUETOOTH_LE)) &#123;</span><br><span class="line">    Toast.makeText(this, R.string.ble_not_supported, Toast.LENGTH_SHORT).show();</span><br><span class="line">    finish();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼š</strong><br>LEä¿¡æ ‡å¾€å¾€ä¸<strong>ä½ç½®</strong>æœ‰å…³ã€‚ ä¸ºäº†åœ¨æ²¡æœ‰è¿‡æ»¤å™¨çš„æƒ…å†µä¸‹ä½¿ç”¨<strong>BluetoothLeScanner</strong>ï¼Œæ‚¨<strong>å¿…é¡»</strong>é€šè¿‡åœ¨åº”ç”¨çš„æ¸…å•æ–‡ä»¶ä¸­å£°æ˜</p>
<ul>
<li><strong>æƒé™3ï¼šACCESS_COARSE_LOCATION</strong> </li>
</ul>
<p>æˆ–</p>
<ul>
<li><strong>æƒé™3ï¼šACCESS_FINE_LOCATION</strong></li>
</ul>
<p>æƒé™æ¥è¯·æ±‚ç”¨æˆ·çš„è®¸å¯ã€‚ <strong>æ²¡æœ‰è¿™äº›æƒé™ï¼Œæ‰«æå°†ä¸ä¼šè¿”å›ä»»ä½•ç»“æœ</strong>ã€‚</p>
<h1 id="è®¾ç½®BLE"><a href="#è®¾ç½®BLE" class="headerlink" title="è®¾ç½®BLE"></a>è®¾ç½®BLE</h1><p>åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡BLEè¿›è¡Œé€šä¿¡ä¹‹å‰ï¼Œæ‚¨éœ€è¦éªŒè¯è®¾å¤‡æ˜¯å¦æ”¯æŒBLEï¼Œå¦‚æœæ˜¯ï¼Œè¯·ç¡®ä¿å·²å¯ç”¨BLEã€‚è¯·æ³¨æ„ï¼Œåªæœ‰åœ¨<uses-feature ...>è®¾ç½®ä¸ºfalseæ—¶æ‰éœ€è¦æ‰§è¡Œæ­¤é¡¹æ£€æŸ¥</uses-feature></p>
<p>å¦‚æœä¸æ”¯æŒBLEï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥ç¦ç”¨ä»»ä½•BLEåŠŸèƒ½ã€‚<br>å¦‚æœBLEæ”¯æŒï¼Œä½†è¢«ç¦ç”¨ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥è¯·æ±‚ç”¨æˆ·å¯ç”¨è“ç‰™ï¼Œè€Œæ— éœ€ç¦»å¼€æ‚¨çš„åº”ç”¨ç¨‹åºã€‚ ä½¿ç”¨<strong>BluetoothAdapter</strong>ï¼Œå¯ä»¥åˆ†ä¸¤æ­¥å®Œæˆæ­¤è®¾ç½®ï¼š</p>
<h2 id="1-è·å–-BluetoothAdapter"><a href="#1-è·å–-BluetoothAdapter" class="headerlink" title="1. è·å– BluetoothAdapter"></a>1. è·å– BluetoothAdapter</h2><p>BluetoothAdapteræ˜¯ä»»ä½•å’Œæ‰€æœ‰çš„è“ç‰™æ´»åŠ¨æ‰€å¿…éœ€çš„ã€‚ BluetoothAdapterä»£è¡¨<strong>è®¾å¤‡è‡ªå·±çš„è“ç‰™é€‚é…å™¨</strong>ï¼ˆè“ç‰™æ— çº¿ç”µï¼‰ã€‚æ•´ä¸ªç³»ç»Ÿæœ‰ä¸€ä¸ªè“ç‰™é€‚é…å™¨ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥<strong>ä½¿ç”¨è¿™ä¸ªå¯¹è±¡ä¸å®ƒè¿›è¡Œäº¤äº’</strong>ã€‚ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•è·å–é€‚é…å™¨ã€‚è¯·æ³¨æ„ï¼Œæ­¤æ–¹æ³•ä½¿ç”¨getSystemServiceï¼ˆï¼‰è¿”å›BluetoothManagerçš„å®ä¾‹ï¼Œç„¶åç”¨äºè·å–é€‚é…å™¨ã€‚ Android 4.3ï¼ˆAPI Level 18ï¼‰ä»‹ç»äº†BluetoothManagerï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">private BluetoothAdapter mBluetoothAdapter;</span><br><span class="line">...</span><br><span class="line">// Initializes Bluetooth adapter.</span><br><span class="line">final BluetoothManager bluetoothManager =</span><br><span class="line">        (BluetoothManager) getSystemService(Context.BLUETOOTH_SERVICE);</span><br><span class="line">mBluetoothAdapter = bluetoothManager.getAdapter();</span><br></pre></td></tr></table></figure>
<h2 id="2-å¯ç”¨è“ç‰™"><a href="#2-å¯ç”¨è“ç‰™" class="headerlink" title="2. å¯ç”¨è“ç‰™"></a>2. å¯ç”¨è“ç‰™</h2><p>æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦ç¡®ä¿è“ç‰™å·²å¯ç”¨ã€‚è°ƒç”¨<strong>isEnabledï¼ˆï¼‰</strong>æ¥æ£€æŸ¥å½“å‰æ˜¯å¦å¯ç”¨äº†è“ç‰™ã€‚å¦‚æœæ­¤æ–¹æ³•è¿”å›falseï¼Œåˆ™è“ç‰™è¢«ç¦ç”¨ã€‚ä»¥ä¸‹ç‰‡æ®µæ£€æŸ¥æ˜¯å¦å¯ç”¨äº†è“ç‰™ã€‚å¦‚æœä¸æ˜¯ï¼Œè¯¥ç‰‡æ®µä¼šæ˜¾ç¤ºä¸€ä¸ªé”™è¯¯ï¼Œæç¤ºç”¨æˆ·è½¬åˆ°è®¾ç½®ä»¥å¯ç”¨è“ç‰™ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// Ensures Bluetooth is available on the device and it is enabled. If not,</span><br><span class="line">// displays a dialog requesting user permission to enable Bluetooth.</span><br><span class="line">if (mBluetoothAdapter == null || !mBluetoothAdapter.isEnabled()) &#123;</span><br><span class="line">    Intent enableBtIntent = new Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);</span><br><span class="line">    startActivityForResult(enableBtIntent, REQUEST_ENABLE_BT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼š</strong><br>ä¼ é€’ç»™ startActivityForResultï¼ˆandroid.content.Intentï¼Œintï¼‰çš„<strong>REQUEST_ENABLE_BT</strong>å¸¸é‡æ˜¯ç³»ç»Ÿåœ¨onActivityResultï¼ˆintï¼Œintï¼Œandroid.contentï¼‰ä¸­è¿”å›ç»™æ‚¨çš„æœ¬åœ°å®šä¹‰çš„æ•´æ•°ï¼ˆå®ƒå¿…é¡»å¤§äº0ï¼‰ï¼‰å®ç°ä½œä¸ºrequestCodeå‚æ•°ã€‚</p>
<h1 id="æŸ¥æ‰¾BLEè®¾å¤‡"><a href="#æŸ¥æ‰¾BLEè®¾å¤‡" class="headerlink" title="æŸ¥æ‰¾BLEè®¾å¤‡"></a>æŸ¥æ‰¾BLEè®¾å¤‡</h1><p>è¦æŸ¥æ‰¾BLEè®¾å¤‡ï¼Œè¯·ä½¿ç”¨<strong>startLeScanï¼ˆï¼‰</strong>æ–¹æ³•ã€‚ æ­¤æ–¹æ³•å°†<strong>BluetoothAdapter.LeScanCallback</strong>ä½œä¸ºå‚æ•°ã€‚ æ‚¨å¿…é¡»å®ç°æ­¤<strong>BluetoothAdapter.LeScanCallback</strong>ï¼Œå› ä¸ºè¿™æ˜¯å¦‚ä½•<strong>è¿”å›æ‰«æç»“æœ</strong>ã€‚ ç”±äºæ‰«æè€—ç”µé‡å¤§ï¼Œæ‚¨åº”éµå®ˆä»¥ä¸‹å‡†åˆ™:</p>
<ul>
<li>ä¸€æ—¦æ‰¾åˆ°æ‰€éœ€çš„è®¾å¤‡ï¼Œè¯·åœæ­¢æ‰«æ</li>
<li>åˆ‡å‹¿æ‰«æå¾ªç¯ï¼Œå¹¶åœ¨æ‰«æä¸Šè®¾ç½®æ—¶é—´é™åˆ¶ã€‚ä»¥å‰å¯ç”¨çš„è®¾å¤‡å¯èƒ½å·²ç§»å‡ºèŒƒå›´ï¼Œå¹¶ç»§ç»­æ‰«æç”µæ± ç”µé‡ã€‚</li>
</ul>
<p>ä»¥ä¸‹ç‰‡æ®µæ˜¾ç¤ºäº†å¦‚ä½•<strong>å¯åŠ¨</strong>å’Œ<strong>åœæ­¢</strong>æ‰«æï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Activity for scanning and displaying available BLE devices.</span><br><span class="line"> */</span><br><span class="line">public class DeviceScanActivity extends ListActivity &#123;</span><br><span class="line"></span><br><span class="line">    private BluetoothAdapter mBluetoothAdapter;</span><br><span class="line">    private boolean mScanning;</span><br><span class="line">    private Handler mHandler;</span><br><span class="line"></span><br><span class="line">    // Stops scanning after 10 seconds.</span><br><span class="line">    private static final long SCAN_PERIOD = 10000;</span><br><span class="line">    ...</span><br><span class="line">    private void scanLeDevice(final boolean enable) &#123;</span><br><span class="line">        if (enable) &#123;</span><br><span class="line">            // Stops scanning after a pre-defined scan period.</span><br><span class="line">            mHandler.postDelayed(new Runnable() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void run() &#123;</span><br><span class="line">                    mScanning = false;</span><br><span class="line">                    mBluetoothAdapter.stopLeScan(mLeScanCallback);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, SCAN_PERIOD);</span><br><span class="line"></span><br><span class="line">            mScanning = true;</span><br><span class="line">            mBluetoothAdapter.startLeScan(mLeScanCallback);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            mScanning = false;</span><br><span class="line">            mBluetoothAdapter.stopLeScan(mLeScanCallback);</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœåªæƒ³æ‰«æç‰¹å®šç±»å‹çš„å¤–è®¾ï¼Œåˆ™æ”¹ä¸ºè°ƒç”¨<strong>startLeScanï¼ˆUUID []ï¼ŒBluetoothAdapter.LeScanCallbackï¼‰</strong>ï¼Œæä¾›<strong>æŒ‡å®š</strong>æ‚¨çš„åº”ç”¨ç¨‹åºæ”¯æŒçš„GATTæœåŠ¡çš„UUIDå¯¹è±¡æ•°ç»„ã€‚</p>
<p>ä»¥ä¸‹æ˜¯<strong>BluetoothAdapter.LeScanCallback</strong>çš„ä¸€ä¸ªå®ç°ï¼Œå®ƒæ˜¯ç”¨äº<strong>ä¼ é€’BLEæ‰«æç»“æœ</strong>çš„æ¥å£ğŸ¤”ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">private LeDeviceListAdapter mLeDeviceListAdapter;</span><br><span class="line">...</span><br><span class="line">// Device scan callback.</span><br><span class="line">private BluetoothAdapter.LeScanCallback mLeScanCallback =</span><br><span class="line">        new BluetoothAdapter.LeScanCallback() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onLeScan(final BluetoothDevice device, int rssi,</span><br><span class="line">            byte[] scanRecord) &#123;</span><br><span class="line">        runOnUiThread(new Runnable() &#123;</span><br><span class="line">           @Override</span><br><span class="line">           public void run() &#123;</span><br><span class="line">               mLeDeviceListAdapter.addDevice(device);</span><br><span class="line">               mLeDeviceListAdapter.notifyDataSetChanged();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„</strong>ï¼š<br>æ‚¨<strong>åªèƒ½</strong>æ‰«æè“ç‰™LEè®¾å¤‡æˆ–æ‰«æç»å…¸è“ç‰™è®¾å¤‡ï¼Œå¦‚è“ç‰™ä¸­æ‰€è¿°ã€‚æ‚¨<strong>æ— æ³•åŒæ—¶</strong>æ‰«æBluetooth LEå’Œä¼ ç»Ÿè®¾å¤‡ã€‚</p>
<h1 id="è¿æ¥åˆ°GATTæœåŠ¡å™¨ï¼ˆå‘é€æ•°æ®çš„BLEè®¾å¤‡ï¼‰"><a href="#è¿æ¥åˆ°GATTæœåŠ¡å™¨ï¼ˆå‘é€æ•°æ®çš„BLEè®¾å¤‡ï¼‰" class="headerlink" title="è¿æ¥åˆ°GATTæœåŠ¡å™¨ï¼ˆå‘é€æ•°æ®çš„BLEè®¾å¤‡ï¼‰"></a>è¿æ¥åˆ°GATTæœåŠ¡å™¨ï¼ˆå‘é€æ•°æ®çš„BLEè®¾å¤‡ï¼‰</h1><p><img src="https://yannischeng-img-1258109292.cos.ap-beijing.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-02-02%2010.11.50.png" alt></p>
<p>ä¸BLEè®¾å¤‡äº¤äº’çš„<strong>ç¬¬ä¸€æ­¥æ˜¯è¿æ¥åˆ°å®ƒ</strong>ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œè¿æ¥åˆ°è®¾å¤‡ä¸Šçš„GATTæœåŠ¡å™¨ã€‚ è¦è¿æ¥åˆ°BLEè®¾å¤‡ä¸Šçš„GATTæœåŠ¡å™¨ï¼Œè¯·ä½¿ç”¨<strong>connectGattï¼ˆï¼‰</strong>æ–¹æ³•ã€‚ æ­¤æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼šä¸€ä¸ª<strong>Context</strong>å¯¹è±¡ï¼Œ<strong>autoConnect</strong>ï¼ˆå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤º<strong>æ˜¯å¦</strong>åœ¨BLEè®¾å¤‡<strong>å˜ä¸ºå¯ç”¨æ—¶è‡ªåŠ¨è¿æ¥</strong>ï¼‰ä»¥åŠå¯¹<strong>BluetoothGattCallback</strong>çš„å¼•ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mBluetoothGatt = device.connectGatt(this, false, mGattCallback);</span><br></pre></td></tr></table></figure>
<p>è¿™å°†è¿æ¥åˆ°ç”±BLEè®¾å¤‡æ‰˜ç®¡çš„GATTæœåŠ¡å™¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªBluetoothGattå®ä¾‹ï¼Œç„¶åæ‚¨å¯ä»¥ä½¿ç”¨è¯¥å®ä¾‹æ¥æ‰§è¡ŒGATTå®¢æˆ·ç«¯æ“ä½œã€‚ è°ƒç”¨è€…ï¼ˆAndroidåº”ç”¨ç¨‹åºï¼‰æ˜¯GATTå®¢æˆ·ç«¯ã€‚ BluetoothGattCallbackç”¨äºå‘å®¢æˆ·ç«¯ä¼ é€’ç»“æœï¼Œä¾‹å¦‚è¿æ¥çŠ¶æ€ï¼Œä»¥åŠä»»ä½•å…¶ä»–GATTå®¢æˆ·ç«¯æ“ä½œ</p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒBLEåº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªActivityï¼ˆDeviceControlActivityï¼‰æ¥è¿æ¥ï¼Œæ˜¾ç¤ºæ•°æ®ï¼Œå¹¶æ˜¾ç¤ºè®¾å¤‡æ”¯æŒçš„GATTæœåŠ¡å’Œç‰¹æ€§ã€‚ æ ¹æ®ç”¨æˆ·è¾“å…¥ï¼Œæ­¤Activityä¸ä¸€ä¸ªåä¸ºBluetoothLeServiceçš„æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œè¯¥æœåŠ¡é€šè¿‡Android BLE APIä¸BLEè®¾å¤‡è¿›è¡Œäº¤äº’ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">// A service that interacts with the BLE device via the Android BLE API.</span><br><span class="line">public class BluetoothLeService extends Service &#123;</span><br><span class="line">    private final static String TAG = BluetoothLeService.class.getSimpleName();</span><br><span class="line"></span><br><span class="line">    private BluetoothManager mBluetoothManager;</span><br><span class="line">    private BluetoothAdapter mBluetoothAdapter;</span><br><span class="line">    private String mBluetoothDeviceAddress;</span><br><span class="line">    private BluetoothGatt mBluetoothGatt;</span><br><span class="line">    private int mConnectionState = STATE_DISCONNECTED;</span><br><span class="line"></span><br><span class="line">    private static final int STATE_DISCONNECTED = 0;</span><br><span class="line">    private static final int STATE_CONNECTING = 1;</span><br><span class="line">    private static final int STATE_CONNECTED = 2;</span><br><span class="line"></span><br><span class="line">    public final static String ACTION_GATT_CONNECTED =</span><br><span class="line">            &quot;com.example.bluetooth.le.ACTION_GATT_CONNECTED&quot;;</span><br><span class="line">    public final static String ACTION_GATT_DISCONNECTED =</span><br><span class="line">            &quot;com.example.bluetooth.le.ACTION_GATT_DISCONNECTED&quot;;</span><br><span class="line">    public final static String ACTION_GATT_SERVICES_DISCOVERED =</span><br><span class="line">            &quot;com.example.bluetooth.le.ACTION_GATT_SERVICES_DISCOVERED&quot;;</span><br><span class="line">    public final static String ACTION_DATA_AVAILABLE =</span><br><span class="line">            &quot;com.example.bluetooth.le.ACTION_DATA_AVAILABLE&quot;;</span><br><span class="line">    public final static String EXTRA_DATA =</span><br><span class="line">            &quot;com.example.bluetooth.le.EXTRA_DATA&quot;;</span><br><span class="line"></span><br><span class="line">    public final static UUID UUID_HEART_RATE_MEASUREMENT =</span><br><span class="line">            UUID.fromString(SampleGattAttributes.HEART_RATE_MEASUREMENT);</span><br><span class="line"></span><br><span class="line">    // Various callback methods defined by the BLE API.</span><br><span class="line">    private final BluetoothGattCallback mGattCallback =</span><br><span class="line">            new BluetoothGattCallback() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onConnectionStateChange(BluetoothGatt gatt, int status,</span><br><span class="line">                int newState) &#123;</span><br><span class="line">            String intentAction;</span><br><span class="line">            if (newState == BluetoothProfile.STATE_CONNECTED) &#123;</span><br><span class="line">                intentAction = ACTION_GATT_CONNECTED;</span><br><span class="line">                mConnectionState = STATE_CONNECTED;</span><br><span class="line">                broadcastUpdate(intentAction);</span><br><span class="line">                Log.i(TAG, &quot;Connected to GATT server.&quot;);</span><br><span class="line">                Log.i(TAG, &quot;Attempting to start service discovery:&quot; +</span><br><span class="line">                        mBluetoothGatt.discoverServices());</span><br><span class="line"></span><br><span class="line">            &#125; else if (newState == BluetoothProfile.STATE_DISCONNECTED) &#123;</span><br><span class="line">                intentAction = ACTION_GATT_DISCONNECTED;</span><br><span class="line">                mConnectionState = STATE_DISCONNECTED;</span><br><span class="line">                Log.i(TAG, &quot;Disconnected from GATT server.&quot;);</span><br><span class="line">                broadcastUpdate(intentAction);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        // New services discovered</span><br><span class="line">        public void onServicesDiscovered(BluetoothGatt gatt, int status) &#123;</span><br><span class="line">            if (status == BluetoothGatt.GATT_SUCCESS) &#123;</span><br><span class="line">                broadcastUpdate(ACTION_GATT_SERVICES_DISCOVERED);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                Log.w(TAG, &quot;onServicesDiscovered received: &quot; + status);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        // Result of a characteristic read operation</span><br><span class="line">        public void onCharacteristicRead(BluetoothGatt gatt,</span><br><span class="line">                BluetoothGattCharacteristic characteristic,</span><br><span class="line">                int status) &#123;</span><br><span class="line">            if (status == BluetoothGatt.GATT_SUCCESS) &#123;</span><br><span class="line">                broadcastUpdate(ACTION_DATA_AVAILABLE, characteristic);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">     ...</span><br><span class="line">    &#125;;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ä¸€ä¸ªç‰¹å®šçš„å›è°ƒè¢«è§¦å‘æ—¶ï¼Œå®ƒä¼šè°ƒç”¨ç›¸åº”çš„broadcastUpdateï¼ˆï¼‰è¾…åŠ©æ–¹æ³•å¹¶ä¼ é€’ä¸€ä¸ªåŠ¨ä½œã€‚ è¯·æ³¨æ„ï¼Œæœ¬èŠ‚ä¸­çš„æ•°æ®è§£ææ˜¯æ ¹æ®è“ç‰™å¿ƒç‡æµ‹é‡é…ç½®æ–‡ä»¶è§„èŒƒæ‰§è¡Œçš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">private void broadcastUpdate(final String action) &#123;</span><br><span class="line">    final Intent intent = new Intent(action);</span><br><span class="line">    sendBroadcast(intent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void broadcastUpdate(final String action,</span><br><span class="line">                             final BluetoothGattCharacteristic characteristic) &#123;</span><br><span class="line">    final Intent intent = new Intent(action);</span><br><span class="line"></span><br><span class="line">    // This is special handling for the Heart Rate Measurement profile. Data</span><br><span class="line">    // parsing is carried out as per profile specifications.</span><br><span class="line">    if (UUID_HEART_RATE_MEASUREMENT.equals(characteristic.getUuid())) &#123;</span><br><span class="line">        int flag = characteristic.getProperties();</span><br><span class="line">        int format = -1;</span><br><span class="line">        if ((flag &amp; 0x01) != 0) &#123;</span><br><span class="line">            format = BluetoothGattCharacteristic.FORMAT_UINT16;</span><br><span class="line">            Log.d(TAG, &quot;Heart rate format UINT16.&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            format = BluetoothGattCharacteristic.FORMAT_UINT8;</span><br><span class="line">            Log.d(TAG, &quot;Heart rate format UINT8.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        final int heartRate = characteristic.getIntValue(format, 1);</span><br><span class="line">        Log.d(TAG, String.format(&quot;Received heart rate: %d&quot;, heartRate));</span><br><span class="line">        intent.putExtra(EXTRA_DATA, String.valueOf(heartRate));</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // For all other profiles, writes the data formatted in HEX.</span><br><span class="line">        final byte[] data = characteristic.getValue();</span><br><span class="line">        if (data != null &amp;&amp; data.length &gt; 0) &#123;</span><br><span class="line">            final StringBuilder stringBuilder = new StringBuilder(data.length);</span><br><span class="line">            for(byte byteChar : data)</span><br><span class="line">                stringBuilder.append(String.format(&quot;%02X &quot;, byteChar));</span><br><span class="line">            intent.putExtra(EXTRA_DATA, new String(data) + &quot;\n&quot; +</span><br><span class="line">                    stringBuilder.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sendBroadcast(intent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å›åˆ°DeviceControlActivityä¸­ï¼Œè¿™äº›äº‹ä»¶ç”±BroadcastReceiverå¤„ç†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// Handles various events fired by the Service.</span><br><span class="line">// ACTION_GATT_CONNECTED: connected to a GATT server.</span><br><span class="line">// ACTION_GATT_DISCONNECTED: disconnected from a GATT server.</span><br><span class="line">// ACTION_GATT_SERVICES_DISCOVERED: discovered GATT services.</span><br><span class="line">// ACTION_DATA_AVAILABLE: received data from the device. This can be a</span><br><span class="line">// result of read or notification operations.</span><br><span class="line">private final BroadcastReceiver mGattUpdateReceiver = new BroadcastReceiver() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onReceive(Context context, Intent intent) &#123;</span><br><span class="line">        final String action = intent.getAction();</span><br><span class="line">        if (BluetoothLeService.ACTION_GATT_CONNECTED.equals(action)) &#123;</span><br><span class="line">            mConnected = true;</span><br><span class="line">            updateConnectionState(R.string.connected);</span><br><span class="line">            invalidateOptionsMenu();</span><br><span class="line">        &#125; else if (BluetoothLeService.ACTION_GATT_DISCONNECTED.equals(action)) &#123;</span><br><span class="line">            mConnected = false;</span><br><span class="line">            updateConnectionState(R.string.disconnected);</span><br><span class="line">            invalidateOptionsMenu();</span><br><span class="line">            clearUI();</span><br><span class="line">        &#125; else if (BluetoothLeService.</span><br><span class="line">                ACTION_GATT_SERVICES_DISCOVERED.equals(action)) &#123;</span><br><span class="line">            // Show all the supported services and characteristics on the</span><br><span class="line">            // user interface.</span><br><span class="line">            displayGattServices(mBluetoothLeService.getSupportedGattServices());</span><br><span class="line">        &#125; else if (BluetoothLeService.ACTION_DATA_AVAILABLE.equals(action)) &#123;</span><br><span class="line">            displayData(intent.getStringExtra(BluetoothLeService.EXTRA_DATA));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1 id="è¯»å–BLEå±æ€§"><a href="#è¯»å–BLEå±æ€§" class="headerlink" title="è¯»å–BLEå±æ€§"></a>è¯»å–BLEå±æ€§</h1><p>ä¸€æ—¦ä½ çš„Androidåº”ç”¨ç¨‹åºè¿æ¥åˆ°GATTæœåŠ¡å™¨å¹¶å‘ç°æœåŠ¡ï¼Œå®ƒå°±å¯ä»¥åœ¨æ”¯æŒçš„åœ°æ–¹è¯»å–å’Œå†™å…¥å±æ€§ã€‚ä¾‹å¦‚ï¼Œè¿™ä¸ªä»£ç ç‰‡æ®µéå†æœåŠ¡å™¨çš„æœåŠ¡å’Œç‰¹æ€§ï¼Œå¹¶åœ¨UIä¸­æ˜¾ç¤ºå®ƒä»¬ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">public class DeviceControlActivity extends Activity &#123;</span><br><span class="line">    ...</span><br><span class="line">    // ï¼ˆæ¼”ç¤ºï¼‰Demonstrates how to ï¼ˆéå†ï¼‰iterate through the supported GATT</span><br><span class="line">    // Services/Characteristics.</span><br><span class="line">    // In this sample, we ï¼ˆå¡«å……ï¼‰populate the data structure that is bound to the</span><br><span class="line">    // ExpandableListView on the UI.</span><br><span class="line">    private void displayGattServices(List&lt;BluetoothGattService&gt; gattServices) &#123;</span><br><span class="line">        if (gattServices == null) return;</span><br><span class="line">        String uuid = null;</span><br><span class="line">        String unknownServiceString = getResources().</span><br><span class="line">                getString(R.string.unknown_service);</span><br><span class="line">        String unknownCharaString = getResources().</span><br><span class="line">                getString(R.string.unknown_characteristic);</span><br><span class="line">        ArrayList&lt;HashMap&lt;String, String&gt;&gt; gattServiceData =</span><br><span class="line">                new ArrayList&lt;HashMap&lt;String, String&gt;&gt;();</span><br><span class="line">        ArrayList&lt;ArrayList&lt;HashMap&lt;String, String&gt;&gt;&gt; gattCharacteristicData</span><br><span class="line">                = new ArrayList&lt;ArrayList&lt;HashMap&lt;String, String&gt;&gt;&gt;();</span><br><span class="line">        mGattCharacteristics =</span><br><span class="line">                new ArrayList&lt;ArrayList&lt;BluetoothGattCharacteristic&gt;&gt;();</span><br><span class="line"></span><br><span class="line">        // Loops through available GATT Services.</span><br><span class="line">        for (BluetoothGattService gattService : gattServices) &#123;</span><br><span class="line">            HashMap&lt;String, String&gt; currentServiceData =</span><br><span class="line">                    new HashMap&lt;String, String&gt;();</span><br><span class="line">            uuid = gattService.getUuid().toString();</span><br><span class="line">            currentServiceData.put(</span><br><span class="line">                    LIST_NAME, SampleGattAttributes.</span><br><span class="line">                            lookup(uuid, unknownServiceString));</span><br><span class="line">            currentServiceData.put(LIST_UUID, uuid);</span><br><span class="line">            gattServiceData.add(currentServiceData);</span><br><span class="line"></span><br><span class="line">            ArrayList&lt;HashMap&lt;String, String&gt;&gt; gattCharacteristicGroupData =</span><br><span class="line">                    new ArrayList&lt;HashMap&lt;String, String&gt;&gt;();</span><br><span class="line">            List&lt;BluetoothGattCharacteristic&gt; gattCharacteristics =</span><br><span class="line">                    gattService.getCharacteristics();</span><br><span class="line">            ArrayList&lt;BluetoothGattCharacteristic&gt; charas =</span><br><span class="line">                    new ArrayList&lt;BluetoothGattCharacteristic&gt;();</span><br><span class="line">           // Loops through available Characteristics.</span><br><span class="line">            for (BluetoothGattCharacteristic gattCharacteristic :</span><br><span class="line">                    gattCharacteristics) &#123;</span><br><span class="line">                charas.add(gattCharacteristic);</span><br><span class="line">                HashMap&lt;String, String&gt; currentCharaData =</span><br><span class="line">                        new HashMap&lt;String, String&gt;();</span><br><span class="line">                uuid = gattCharacteristic.getUuid().toString();</span><br><span class="line">                currentCharaData.put(</span><br><span class="line">                        LIST_NAME, SampleGattAttributes.lookup(uuid,</span><br><span class="line">                                unknownCharaString));</span><br><span class="line">                currentCharaData.put(LIST_UUID, uuid);</span><br><span class="line">                gattCharacteristicGroupData.add(currentCharaData);</span><br><span class="line">            &#125;</span><br><span class="line">            mGattCharacteristics.add(charas);</span><br><span class="line">            gattCharacteristicData.add(gattCharacteristicGroupData);</span><br><span class="line">         &#125;</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ¥æ”¶GATTé€šçŸ¥"><a href="#æ¥æ”¶GATTé€šçŸ¥" class="headerlink" title="æ¥æ”¶GATTé€šçŸ¥"></a>æ¥æ”¶GATTé€šçŸ¥</h1><p>BLEåº”ç”¨ç¨‹åº<strong>åœ¨è®¾å¤‡ä¸Šå‘ç”Ÿç‰¹å®šç‰¹å¾å˜åŒ–æ—¶</strong>è¦æ±‚æ”¶åˆ°é€šçŸ¥æ˜¯å¾ˆå¸¸è§çš„ã€‚è¿™æ®µä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨setCharacteristicNotificationï¼ˆï¼‰æ–¹æ³•ä¸ºç‰¹æ€§<strong>è®¾ç½®é€šçŸ¥</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">private BluetoothGatt mBluetoothGatt;</span><br><span class="line">BluetoothGattCharacteristic characteristic;</span><br><span class="line">boolean enabled;</span><br><span class="line">...</span><br><span class="line">mBluetoothGatt.setCharacteristicNotification(characteristic, enabled);</span><br><span class="line">...</span><br><span class="line">BluetoothGattDescriptor descriptor = characteristic.getDescriptor(</span><br><span class="line">        UUID.fromString(SampleGattAttributes.CLIENT_CHARACTERISTIC_CONFIG));</span><br><span class="line">descriptor.setValue(BluetoothGattDescriptor.ENABLE_NOTIFICATION_VALUE);</span><br><span class="line">mBluetoothGatt.writeDescriptor(descriptor);</span><br></pre></td></tr></table></figure>
<p>ä¸€æ—¦ä¸ºç‰¹å¾å¯ç”¨äº†é€šçŸ¥ï¼Œå¦‚æœç‰¹æ€§åœ¨è¿œç¨‹è®¾å¤‡ä¸Šå‘ç”Ÿå˜åŒ–ï¼Œåˆ™ä¼šè§¦å‘onCharacteristicChangedï¼ˆï¼‰å›è°ƒï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">// Characteristic notification</span><br><span class="line">public void onCharacteristicChanged(BluetoothGatt gatt,</span><br><span class="line">        BluetoothGattCharacteristic characteristic) &#123;</span><br><span class="line">    broadcastUpdate(ACTION_DATA_AVAILABLE, characteristic);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="å…³é—­å®¢æˆ·ç«¯App"><a href="#å…³é—­å®¢æˆ·ç«¯App" class="headerlink" title="å…³é—­å®¢æˆ·ç«¯App"></a>å…³é—­å®¢æˆ·ç«¯App</h1><p>ä¸€æ—¦æ‚¨çš„åº”ç”¨ç¨‹åºä½¿ç”¨BLEè®¾å¤‡ï¼Œåº”è¯¥è°ƒç”¨closeï¼ˆï¼‰ï¼Œä»¥ä¾¿ç³»ç»Ÿå¯ä»¥æ­£ç¡®é‡Šæ”¾èµ„æºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public void close() &#123;</span><br><span class="line">    if (mBluetoothGatt == null) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    mBluetoothGatt.close();</span><br><span class="line">    mBluetoothGatt = null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Android-BLE-API"><a href="#Android-BLE-API" class="headerlink" title="Android BLE API"></a>Android BLE API</h1><h2 id="BluetoothAdapter"><a href="#BluetoothAdapter" class="headerlink" title="BluetoothAdapter"></a>BluetoothAdapter</h2><p>ä»£è¡¨æœ¬åœ°è®¾å¤‡è“ç‰™é€‚é…å™¨ã€‚ BluetoothAdapterå…è®¸æ‚¨<strong>æ‰§è¡ŒåŸºæœ¬çš„è“ç‰™ä»»åŠ¡</strong>ï¼Œä¾‹å¦‚å¯åŠ¨è®¾å¤‡å‘ç°ï¼ŒæŸ¥è¯¢ç»‘å®šï¼ˆé…å¯¹ï¼‰è®¾å¤‡åˆ—è¡¨ï¼Œä½¿ç”¨å·²çŸ¥çš„MACåœ°å€å®ä¾‹åŒ–BluetoothDeviceï¼Œå¹¶åˆ›å»ºBluetoothServerSocketä»¥ä¾¦å¬æ¥è‡ªå…¶ä»–è®¾å¤‡çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶å¯åŠ¨æ‰«æè“ç‰™LEè®¾å¤‡ã€‚</p>
<p>è¦è·å¾—ä»£è¡¨æœ¬åœ°è“ç‰™é€‚é…å™¨çš„BluetoothAdapterï¼Œè¯·åœ¨<strong>BluetoothManager</strong>ä¸Šè°ƒç”¨getAdapterï¼ˆï¼‰å‡½æ•°ã€‚åœ¨JELLY_BEAN_MR1å’Œä¸‹é¢ï¼Œæ‚¨å°†éœ€è¦ä½¿ç”¨é™æ€getDefaultAdapterï¼ˆï¼‰æ–¹æ³•ã€‚</p>
<p>ä»æ ¹æœ¬ä¸Šè¯´ï¼Œè¿™<strong>æ˜¯æ‰€æœ‰è“ç‰™æ“ä½œçš„èµ·ç‚¹</strong>ã€‚ä¸€æ—¦ä½ æœ‰äº†æœ¬åœ°é€‚é…å™¨ï¼Œä½ å°±å¯ä»¥ç”¨getBondedDevicesï¼ˆï¼‰è·å¾—ä¸€ç»„ä»£è¡¨æ‰€æœ‰é…å¯¹è®¾å¤‡çš„BluetoothDeviceå¯¹è±¡ã€‚ç”¨startDiscoveryï¼ˆï¼‰å¯åŠ¨è®¾å¤‡å‘ç°;æˆ–è€…ç”¨listenUsingRfcommWithServiceRecordï¼ˆStringï¼ŒUUIDï¼‰åˆ›å»ºä¸€ä¸ªBluetoothServerSocketç›‘å¬ä¼ å…¥çš„è¿æ¥è¯·æ±‚;æˆ–ä½¿ç”¨startLeScanï¼ˆLeScanCallbackï¼‰å¼€å§‹æ‰«æè“ç‰™LEè®¾å¤‡ã€‚</p>
<p><strong>æ³¨ï¼š</strong><br>å¤§å¤šæ•°æ–¹æ³•éœ€è¦<strong>BLUETOOTH</strong>æƒé™ï¼Œæœ‰äº›è¿˜éœ€è¦<strong>BLUETOOTH_ADMIN</strong>æƒé™ã€‚</p>
<p><strong>BluetoothAdapter.LeScanCallback</strong>ï¼šç”¨äºæä¾›LEæ‰«æç»“æœçš„å›è°ƒæ¥å£ã€‚</p>
<h2 id="BluetoothManager"><a href="#BluetoothManager" class="headerlink" title="BluetoothManager"></a>BluetoothManager</h2><p>ç”¨äºè·å–BluetoothAdapterçš„å®ä¾‹å¹¶è¿›è¡Œæ•´ä½“è“ç‰™ç®¡ç†ã€‚ä½¿ç”¨å¸¦æœ‰BLUETOOTH_SERVICEçš„getSystemServiceï¼ˆjava.lang.Stringï¼‰æ¥åˆ›å»ºä¸€ä¸ªBluetoothManagerï¼Œç„¶åè°ƒç”¨getAdapterï¼ˆï¼‰æ¥è·å¾—BluetoothAdapter</p>
<h2 id="BluetoothGatt"><a href="#BluetoothGatt" class="headerlink" title="BluetoothGatt"></a>BluetoothGatt</h2><p>è“ç‰™GATTé…ç½®æ–‡ä»¶çš„å…¬å…±APIã€‚</p>
<p>æœ¬classæä¾›è“ç‰™GATTåŠŸèƒ½ï¼Œä»¥å®ç°ä¸Bluetooth Smartæˆ–Smart Readyè®¾å¤‡çš„é€šä¿¡ã€‚</p>
<p>è¦è¿æ¥åˆ°è¿œç¨‹å¤–å›´è®¾å¤‡ï¼Œè¯·åˆ›å»ºä¸€ä¸ªBluetoothGattCallbackå¹¶è°ƒç”¨connectGattï¼ˆContextï¼Œbooleanï¼ŒBluetoothGattCallbackï¼‰æ¥è·å–æ­¤ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚ ä½¿ç”¨è“ç‰™è®¾å¤‡å‘ç°æˆ–BLEæ‰«æè¿‡ç¨‹å¯ä»¥å‘ç°æ”¯æŒGATTçš„è®¾å¤‡ã€‚</p>
<h2 id="BluetoothGattCallback"><a href="#BluetoothGattCallback" class="headerlink" title="BluetoothGattCallback"></a>BluetoothGattCallback</h2><p>è¿™ä¸ªæŠ½è±¡ç±»çš„ä½œç”¨æ˜¯å®ç°<strong>BluetoothGatt</strong>çš„å›è°ƒã€‚</p>
<h2 id="BluetoothGattCharacteristic"><a href="#BluetoothGattCharacteristic" class="headerlink" title="BluetoothGattCharacteristic"></a>BluetoothGattCharacteristic</h2><p>ä»£è¡¨è“ç‰™GATTç‰¹æ€§ã€‚GATTç‰¹æ€§æ˜¯ç”¨äºæ„å»ºGATTæœåŠ¡çš„<strong>åŸºæœ¬æ•°æ®å…ƒç´ </strong>ï¼ŒBluetoothGattServiceã€‚ è¯¥ç‰¹æ€§åŒ…å«ä¸€ä¸ªå€¼ä»¥åŠé™„åŠ ä¿¡æ¯å’Œå¯é€‰çš„GATTæè¿°ç¬¦BluetoothGattDescriptorã€‚</p>
<h2 id="BluetoothGattService"><a href="#BluetoothGattService" class="headerlink" title="BluetoothGattService"></a>BluetoothGattService</h2><p>ä»£è¡¨ä¸€ä¸ªè“ç‰™GATTæœåŠ¡ã€‚GattæœåŠ¡åŒ…å«ä¸€ç³»åˆ—BluetoothGattCharacteristicä»¥åŠå¼•ç”¨çš„æœåŠ¡ã€‚</p>
<h2 id="BluetoothGattDescriptor"><a href="#BluetoothGattDescriptor" class="headerlink" title="BluetoothGattDescriptor"></a>BluetoothGattDescriptor</h2><p>ä»£è¡¨ä¸€ä¸ªè“ç‰™GATTæè¿°ç¬¦.GATTæè¿°ç¬¦åŒ…å«GATTç‰¹æ€§çš„<strong>é™„åŠ ä¿¡æ¯</strong>å’Œ<strong>å±æ€§</strong>ï¼ŒBluetoothGattCharacteristicã€‚ å®ƒä»¬å¯ä»¥ç”¨æ¥æè¿°ç‰¹å¾çš„ç‰¹å¾æˆ–æ§åˆ¶ç‰¹å¾çš„æŸäº›è¡Œä¸ºã€‚</p>

      
    </div>
    
    
    

    

    


    <footer class="post-footer">
      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/Python3-Scrapyçˆ¬å–åœ°å€5çº§è”åŠ¨æ•°æ® - åˆçº§/" rel="next" title="Python3-Scrapyçˆ¬å–åœ°å€5çº§è”åŠ¨æ•°æ® - åˆçº§">
                <i class="fa fa-chevron-left"></i> Python3-Scrapyçˆ¬å–åœ°å€5çº§è”åŠ¨æ•°æ® - åˆçº§
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/Androidä¼ ç»Ÿè“ç‰™å¼€å‘/" rel="prev" title="Androidä¼ ç»Ÿè“ç‰™å¼€å‘">
                Androidä¼ ç»Ÿè“ç‰™å¼€å‘ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="http://oy991qm3u.bkt.clouddn.com/%E6%A2%B5%E9%AB%98.gif" alt="YannisCheng">
            
              <p class="site-author-name" itemprop="name">YannisCheng</p>
              <p class="site-description motion-element" itemprop="description">ä¸å¿…ä¸€å‘³çš„è®¨å¥½åˆ«äººï¼Œæ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„æ´»æ³•ã€‚</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">174</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">74</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/YannisCheng" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:cwj1714@163.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#è“ç‰™å”¯ä¸€èº«ä»½æ ‡è¯†"><span class="nav-number">1.</span> <span class="nav-text">è“ç‰™å”¯ä¸€èº«ä»½æ ‡è¯†</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BLE-Bluetooth-Low-Energy-ä½åŠŸè€—è“ç‰™"><span class="nav-number">2.</span> <span class="nav-text">BLE (Bluetooth Low Energy) ä½åŠŸè€—è“ç‰™</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#å…³é”®æœ¯è¯­ï¼ˆKey-Termsï¼‰å’Œ-æ¦‚å¿µï¼ˆConceptsï¼‰"><span class="nav-number">3.</span> <span class="nav-text">å…³é”®æœ¯è¯­ï¼ˆKey Termsï¼‰å’Œ æ¦‚å¿µï¼ˆConceptsï¼‰</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#è§’è‰²ï¼ˆRolesï¼‰å’Œè´£ä»»ï¼ˆResponsibilitiesï¼‰"><span class="nav-number">4.</span> <span class="nav-text">è§’è‰²ï¼ˆRolesï¼‰å’Œè´£ä»»ï¼ˆResponsibilitiesï¼‰</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BLE-æƒé™ï¼ˆPermissionsï¼‰"><span class="nav-number">5.</span> <span class="nav-text">BLE æƒé™ï¼ˆPermissionsï¼‰</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#è®¾ç½®BLE"><span class="nav-number">6.</span> <span class="nav-text">è®¾ç½®BLE</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-è·å–-BluetoothAdapter"><span class="nav-number">6.1.</span> <span class="nav-text">1. è·å– BluetoothAdapter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-å¯ç”¨è“ç‰™"><span class="nav-number">6.2.</span> <span class="nav-text">2. å¯ç”¨è“ç‰™</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#æŸ¥æ‰¾BLEè®¾å¤‡"><span class="nav-number">7.</span> <span class="nav-text">æŸ¥æ‰¾BLEè®¾å¤‡</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#è¿æ¥åˆ°GATTæœåŠ¡å™¨ï¼ˆå‘é€æ•°æ®çš„BLEè®¾å¤‡ï¼‰"><span class="nav-number">8.</span> <span class="nav-text">è¿æ¥åˆ°GATTæœåŠ¡å™¨ï¼ˆå‘é€æ•°æ®çš„BLEè®¾å¤‡ï¼‰</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#è¯»å–BLEå±æ€§"><span class="nav-number">9.</span> <span class="nav-text">è¯»å–BLEå±æ€§</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#æ¥æ”¶GATTé€šçŸ¥"><span class="nav-number">10.</span> <span class="nav-text">æ¥æ”¶GATTé€šçŸ¥</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#å…³é—­å®¢æˆ·ç«¯App"><span class="nav-number">11.</span> <span class="nav-text">å…³é—­å®¢æˆ·ç«¯App</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Android-BLE-API"><span class="nav-number">12.</span> <span class="nav-text">Android BLE API</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#BluetoothAdapter"><span class="nav-number">12.1.</span> <span class="nav-text">BluetoothAdapter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BluetoothManager"><span class="nav-number">12.2.</span> <span class="nav-text">BluetoothManager</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BluetoothGatt"><span class="nav-number">12.3.</span> <span class="nav-text">BluetoothGatt</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BluetoothGattCallback"><span class="nav-number">12.4.</span> <span class="nav-text">BluetoothGattCallback</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BluetoothGattCharacteristic"><span class="nav-number">12.5.</span> <span class="nav-text">BluetoothGattCharacteristic</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BluetoothGattService"><span class="nav-number">12.6.</span> <span class="nav-text">BluetoothGattService</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BluetoothGattDescriptor"><span class="nav-number">12.7.</span> <span class="nav-text">BluetoothGattDescriptor</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">YannisCheng</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">412.3k</span>
  
</div>













        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  
  


  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.3"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.3"></script>


  


<script type="text/javascript" color="18,146,19" opacity="0.7" zindex="-1" count="0" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script>

</body>
</html>
